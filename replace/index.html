<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çƒè¡£è¡Œçµ±è¨ˆå·¥å…·</title>
    <style>
        body {
          font-family: Arial, sans-serif;
          background-color: #f5f5f5;
          margin: 0;
          padding: 20px;
          display: flex;
          justify-content: center;
          align-items: flex-start;
          min-height: 100vh;
          overflow: auto;
        }

        .container {
          background-color: #fff;
          border-radius: 8px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
          padding: 20px 20px;
          width: 100%;
          max-width: 800px;
          box-sizing: border-box;
          position: relative;
          margin-top: auto;
          margin-bottom: auto;
          overflow: auto;
        }

        h1 {
          color: #333;
          text-align: center;
          margin-bottom: 10px;
          font-size: 32px;
        }

        h2 {
          color: #555;
          margin-bottom: 5px;
          font-size: 24px;
        }



        textarea {
          display: block;
          margin-bottom: 10px;
          padding: 10px;
          width: 100%;
          height: 100px;
          border: 1px solid #ccc;
          border-radius: 5px;
          box-shadow: inset 2px 2px 5px rgba(0, 0, 0, 0.1);
          font-size: 14px;
          resize: vertical;
          box-sizing: border-box;
        }

        textarea:focus {
          outline: none;
          border-color: #aaa;
          box-shadow: 0 0 4px rgba(153, 153, 153, 0.5);
        }

        .section {
          margin-bottom: 10px;
          position: relative;
        }

        .result-container {
          display: flex;
          flex-wrap: wrap;
          justify-content: space-between;
        }

        .result-wrapper {
          width: 100%;
          margin-bottom: 20px;
        }

        .result-wrapper:nth-child(2) {
          margin-bottom: 0;
        }

        .button-container select {
          margin-right: 5px;
          margin-bottom: 0px;
          padding: 5px 8px;
          font-size: 14px;
          color: #fff;
          background-color: #999;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          box-shadow: 2px 2px 5px rgba(50, 50, 50, 0.1);
          transition: background-color 0.3s ease;
        }





        button {
          margin-right: 5px;
          margin-bottom: 0px;
          padding: 5px 8px;
          font-size: 14px;
          color: #fff;
          background-color: #999;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          box-shadow: 2px 2px 5px rgba(50, 50, 50, 0.1);
          transition: background-color 0.3s ease;
        }

        button:hover {
          background-color: #555;
        }

        button:disabled {
          background-color: #ccc;
          cursor: not-allowed;
        }

        .button-container {
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          margin-bottom: 10px;
        }

        .clear-button-All,
        .clear-button-A,
        .clear-button-B,
        .clear-button-C,
        .copy-button-A,
        .copy-button-B,
        .copy-button-C,
        .sort-bigN-button-B,
        .sort-smallN-button-B,
        .sort-bigN-button-C,
        .sort-smallN-button-C {
          width: 20px;
          height: 20px;
          background-color: #ccc;
          color: white;
          border: none;
          border-radius: 50%;
          cursor: pointer;
          display: flex;
          justify-content: center;
          align-items: center;
          font-size: 12px;
          line-height: 25px;
        }

        .sort-bigN-button-B:hover,
        .sort-bigN-button-C:hover {
          background-color: #5cc;
        }

        .sort-smallN-button-B:hover,
        .sort-smallN-button-C:hover {
          background-color: #ca0;
        }

        .clear-button-All:hover,
        .clear-button-A:hover,
        .clear-button-B:hover,
        .clear-button-C:hover {
          background-color: #a55;
        }

        .copy-button-A:hover,
        .copy-button-B:hover,
        .copy-button-C:hover {
          background-color: #55c;
        }

        .small-button-container-All {
          position: absolute;
          top: 30px;
          left: 20px;
          display: flex;
          gap: 3px;
        }

        .small-button-container-A,
        .small-button-container-BC {
          display: flex;
          gap: 3px;
        }

        .small-button-container-A {
          top: 10px;
          right: 10px;
          position: absolute;
        }

        .small-button-container-BC {
          top: 30px;
          right: 10px;
          position: absolute;
        }

        .dropdown-container {
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          margin-bottom: 10px;
        }


        .dropdown {
          display: block;
          flex: 1 1 calc(50% - 10px);
          /* è¨­ç½®æ¯å€‹ä¸‹æ‹‰é¸å–®çš„å¯¬åº¦ç‚ºå®¹å™¨å¯¬åº¦çš„ä¸€åŠï¼Œä¸¦ç•™å‡ºé–“éš” */
          margin: 5px;
          /* è¨­ç½®ä¸‹æ‹‰é¸å–®çš„é–“éš” */
        }

        .dropdown select {
          width: 100%;
          padding: 10px;
          font-size: 14px;
          border: 1px solid #ccc;
          border-radius: 5px;
          box-sizing: border-box;
        }


        select:focus {
          outline: none;
          border-color: #555;
        }

        @media (min-width: 600px) {
          .result-wrapper {
            width: 48%;
          }

          .result-wrapper:nth-child(2) {
            margin-bottom: 20px;
          }

          .dropdown-container {
            display: none;
          }
        }

        @media (max-width: 599px) {
          .button-container {
            display: none;
          }

          .dropdown {
            display: block;
          }
        }


        /* Modal styles */
        .modal {
          display: none;
          position: fixed;
          z-index: 1;
          left: auto;
          top: 50%;
        }

        .modal-content-container {
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          text-align: center;
        }

        .modal-content {
          background-color: #fefefe;
          border-radius: 10px;
          padding: 20px 20px 20px 20px;
          border: 1px solid #888;
          max-width: 350px;
          min-width: 350px;
          cursor: move;
        }

        .close {
          color: #aaa;
          float: right;
          font-size: 30px;
          font-weight: bold;
        }


        .close:hover,
        .close:focus {
          color: black;
          text-decoration: none;
          cursor: pointer;
        }

        /* Flex container for input groups */
        .input-group {
          display: flex;
          align-items: center;
          margin-bottom: 10px;
          font-size: 16px;
        }

        .input-group label {
          min-width: 100px;
          /* Adjust label width to align text fields */
          text-align: right;
          /* Align text to the right */
          margin-right: 10px;
          /* Space between label and input */
        }

        .input-group input[type="text"],
        .input-group select {
          flex: 1;
          border-radius: 5px;
        }

        .input-group input[type="checkbox"] {
          margin-right: 10px;
          /* Space between checkbox and label */
        }

        .input-group select {
          margin-left: 10px;
          min-width: 150px;
        }


        #confirmButton {
          background-color: #c55;
        }


        /* Styles for visible and hidden states */
        .show {
          display: block;
        }

        .hide {
          display: none;
        }

        .regexChars {
          padding: 0px 0px 0px 10px;
        }

        .hidden {
          display: none;
        }


        .toast {
          visibility: hidden;
          min-width: 250px;
          margin-left: -125px;
          background-color: #888;
          color: #fff;
          text-align: center;
          border-radius: 5px;
          padding: 16px;
          position: fixed;
          z-index: 1;
          left: 50%;
          top: 30px;
          font-size: 17px;
          transition: visibility 0.5s, opacity 0.5s ease-in-out;
          opacity: 0;
        }

        .toast.show {
          visibility: visible;
          opacity: 1;
        }
    </style>
</head>
<body>

<div class="container">
  <div class="small-button-container-All">
    <span class="copy-button-A" id="undoButton" title="é‚„åŸ">â­ </span>
    <span class="copy-button-A" id="redoButton" title="é‡åš">â­¢</span>
    <span class="copy-button-A" id="replaceButton2" title="å–ä»£">å–</span>
    <span class="clear-button-All" onclick="clearAllData()"
      title="å…¨éƒ¨æ¸…é™¤">X</span>
  </div>

  <h1>çµ±è¨ˆå·¥å…·</h1>
  <div class="section">
    <h2>è¼¸å…¥</h2>
    <textarea id="id_A" placeholder="è¼¸å…¥æ–‡å­—..."></textarea>
    <div class="small-button-container-A">
      <span class="copy-button-A" onclick="swapLeftAndRightIdA()"
        title="å·¦å³äº¤æ›">â‡„</span>
      <span class="copy-button-A" onclick="sortDataA('big')"
        title="å¤§åˆ°å°æ’åº">â–¼</span>
      <span class="copy-button-A" onclick="sortDataA('small')"
        title="å°åˆ°å¤§æ’åº">â–²</span>
      <span class="copy-button-A" id="replaceButton" title="åŸåœ°å–ä»£">ä»£</span>
      <span class="copy-button-A" onclick="removeDuplicateLines('id_A')"
        title="åŸåœ°å»é™¤é‡è¤‡">U</span>
      <span class="copy-button-A" onclick="copyData('id_A')" title="è¤‡è£½">C</span>
      <span class="clear-button-A" onclick="clearData('id_A')"
        title="æ¸…é™¤">X</span>
    </div>
  </div>

  <div class="button-container">

    <select onchange="handleDropdownChange(this)" onfocus="showOptions(this)"
      onblur="resetOptions(this)">
      <option value="" disabled selected>å­—æ•¸é »ç‡</option>
      <option value="countTextStatistics" title="a1">ç¸½å­—æ•¸</option>
      <option value="countSentenceLengths" title="a1">å¥å­—æ•¸</option>
      <option value="countLineLengths" title="a1">è¡Œå­—æ•¸</option>
      <option value="" disabled></option>
      <option value="countWords" title="a1">ç¸½è©é »</option>
      <option value="countChineseCharacters" title="a1">æ¼¢å­—é »</option>
      <option value="countChineseWords" title="a1">æ¼¢è©é »</option>
      <option value="countPinyin" title="a1">æ‹¼éŸ³é »</option>
      <option value="countMultiSyllables" title="a1">å¤šéŸ³ç¯€é »</option>
    </select>

    <select onchange="handleDropdownChange(this)" onfocus="showOptions(this)"
      onblur="resetOptions(this)">
      <option value="" disabled selected>å­—éŸ³æ•´ä½µ</option>
      <option value="combineCharacter" title="Excelå·¦æ¬„æ¼¢å­—å³æ¬„æ‹¼éŸ³ï¼Œè¼¸å‡ºï¼šè©”\zhiox å®‰\onv å®¢\kaz äº‹\su">ä½µå–®éŸ³ç¯€</option>
      <option value="combineHyphen" title="Excelå·¦æ¬„æ¼¢å­—å³æ¬„æ‹¼éŸ³ï¼Œè¼¸å‡ºï¼šè©”å®‰\zhiox-onv å®¢äº‹\kaz-su">ä½µå¤šéŸ³ç¯€</option>
      <option value="combineWords" title="å·¦æ¬„æ¼¢å­—è¦åˆ†è©ï¼Œå³æ¬„æ‹¼éŸ³ï¼Œè¼¸å‡ºï¼šè©”å®‰\zhiox onv_å®¢äº‹\kaz su">è©éŸ³åˆä½µ</option>
      <option value="combineWordsPinyin" title="å·¦æ¬„æ¼¢å­—è¦åˆ†è©ï¼Œå³æ¬„æ‹¼éŸ³ï¼Œè¼¸å‡ºï¼šè©”\zhiox å®‰\onv_å®¢\kaz äº‹\su">è©éŸ³äº¤éŒ¯</option>
      <option value="arrangeText" title="æ–‡a å­—b => æ–‡å­—\a b">å­—éŸ³è©éŸ³</option>
	  <option value="reverseArrangeText" title="æ–‡å­—\a b => æ–‡a å­—b">è©éŸ³å­—éŸ³</option>
	  <option value="" disabled></option>
      <option value="examText" title="Excelã€Œæ•¸å­— æ¼¢å­— æ‹¼éŸ³ã€">å­—éŸ³å­—å½¢</option>
      <option value="rubyText" title="Rubyæ³¨éŸ³æ¨™ç¤º">&#123;æ¼¢å­—/æ¨™éŸ³&#125;</option>
    </select>

    <select onchange="handleDropdownChange(this)" onfocus="showOptions(this)"
      onblur="resetOptions(this)">
      <option value="" disabled selected>è©”å®‰éŸ³è½‰</option>
      <option value="kasuToneOriginalChange" title="è©”å®‰æœ¬èª¿kaz-suè½‰æœ¬è®Šèª¿kazc-su">å®‰è½‰æœ¬è®Š
      </option>
      <option value="zxvToneToOriginal" title="è©”å®‰æœ¬è®Šèª¿è½‰æœ¬èª¿">è©”å®‰ç•™æœ¬</option>
      <option value="zxvToneToChange" title="è©”å®‰æœ¬è®Šèª¿è½‰è®Šèª¿">è©”å®‰ç•™è®Š</option>
      <option value="zxvToneToChangeOral" title="è©”å®‰æœ¬è®Šèª¿è½‰åˆå£èªè®Šèª¿">å®‰è®ŠåˆéŸ³</option>
      <option value="zxvToneToChangeOralOld" title="è©”å®‰æœ¬è®Šèª¿èˆŠåˆéŸ³è½‰æ–°">èˆŠè½‰æ–°åˆ</option>
      <option value="toneToZxv" title="å®¢èªè²èª¿è½‰å­—æ¯èª¿">ËŠè½‰z</option>
      <option value="zxvToTone" title="å®¢èªè²èª¿è½‰å­—æ¯èª¿">zè½‰ËŠ</option>
      <option value="rovToRHOOBB" title="è©”å®‰ç°¡æ‹¼è½‰æ•™æ‹¼">ç°¡æ‹¼è½‰æ•™æ‹¼</option>
      <option value="rhoobbToROV" title="è©”å®‰æ•™æ‹¼è½‰ç°¡æ‹¼">æ•™æ‹¼è½‰ç°¡æ‹¼</option>
      <option value="kasuime">è©”å®‰è¼¸å…¥æ³•</option>
      <option value="importData">è¼‰å…¥txt</option>
    </select>

    <select onchange="handleDropdownChange(this)" onfocus="showOptions(this)"
      onblur="resetOptions(this)">
      <option value="" disabled selected>å°ç£å°èª</option>
      <option value="holoNumberToRoman">å°a2è½‰Ã¡</option>
      <option value="holoRomanToNumber">å°Ã¡è½‰a2</option>
      <option value="pojToTailuo">æ•™ç¾…è½‰å°</option>
      <option value="anyZvsToRoma">az è½‰ Ã¡</option>
      <option value="anyRomaToZvs">Ã¡ è½‰ az</option>
	  <option value="holoNumberToKp" title="å°ç¾…è½‰å®¢ç¾…gç”¨w">å°a2è½‰Kp</option>
    </select>

    <select onchange="handleDropdownChange(this)" onfocus="showOptions(this)"
      onblur="resetOptions(this)">
      <option value="" disabled selected>å…¶ä»–</option>
      <option value="importData">è¼‰å…¥txt</option>
      <option value="matchText" title="è© è©å½™ã€è©æ¢ã€èªè©">è©²è©æœ‰å­—</option>
      <option value="matchData" title="è©å½™ è§£é‡‹ï¼›æŸ¥è©">è©è§£æŸ¥æŸ¥</option>
      <option value="replaceFn">è‡ªè¨‚å–ä»£</option>
      <option value="removeDuplicateLinesIdB">å»é™¤é‡è¤‡</option>
      <option value="convertToFullMark">å…¨å½¢æ¨™é»</option>
      <option value="convertToHalfMark">åŠå½¢æ¨™é»</option>
      <option value="spaceToUnderline">ç©ºéš”ç‚º_</option>
      <option value="splitTextByPunctuation">æ¨™é»æ–·è¡Œ</option>
      <option value="connectText">æ–·è¡Œæ¥å›</option>
      <option value="spaceToNewline">\s_æ›è¡Œ</option>

      <option value="wordWrongToRight">æ ¡æ­£ç•°å­—</option>
      <option value="generateText" title="ä¸€ä½ ç”Ÿæˆèªè©">ç”Ÿæˆèªè©</option>
    </select>


  </div>

  <div class="dropdown-container"></div>


  <div class="result-container">
    <div class="section result-wrapper">
      <h2 id="toggle-textarea-c">( ç´¯åŠ  / æŸ¥è© )</h2>
      <textarea id="id_C" placeholder="æ¬¡æ•¸ã€€æ–‡å­—..."></textarea>
      <div class="small-button-container-BC" id="smallButtonContainer_C">
        <span class="copy-button-A" onclick="swapLeftAndRightIdC()"
          title="å·¦å³äº¤æ›">â‡„</span>
        <span class="sort-bigN-button-C"
          onclick="toggleSort('id_C', 'left', this)" sort-big="true"
          title="å·¦æ’åº">â—¤</span>
        <span class="sort-bigN-button-C"
          onclick="toggleSort('id_C', 'right', this)" sort-big="true"
          title="å³æ’åº">â—¥</span>
        <span class="copy-button-B" onclick="copyDataTo('id_C','id_A')"
          title="ç§»åˆ°åˆ°è¼¸å…¥">ğ–¤‚</span>
        <span class="copy-button-C" onclick="copyData('id_C')"
          title="è¤‡è£½">C</span>
        <span class="clear-button-C" onclick="clearData('id_C')"
          title="æ¸…é™¤">X</span>
      </div>
    </div>
    <div class="section result-wrapper">
      <h2>è¼¸å‡º</h2>
      <textarea id="id_B" readonly placeholder="çµ±è¨ˆçµæœ..."></textarea>
      <div class="small-button-container-BC">
        <span class="copy-button-A" onclick="swapLeftAndRightIdB()"
          title="å·¦å³äº¤æ›">â‡„</span>
        <span class="sort-bigN-button-C"
          onclick="toggleSort('id_B', 'left', this)" sort-big="true"
          title="å·¦æ’åº">â—¤</span>
        <span class="sort-bigN-button-C"
          onclick="toggleSort('id_B', 'right', this)" sort-big="true"
          title="å³æ’åº">â—¥</span>
        <span class="copy-button-B" onclick="copyDataTo('id_B','id_A')"
          title="ç§»åˆ°åˆ°è¼¸å…¥">ğ–¤‚</span>
        <span class="copy-button-B" onclick="copyDataB()" title="è¤‡è£½123">C</span>
        <span class="clear-button-B" onclick="clearData('id_B')"
          title="æ¸…é™¤">X</span>
      </div>
    </div>
  </div>
  <div class="section">
    <h2>é¡¯ç¤º</h2>
    <div id="id_D" placeholder="è¼¸å…¥æ–‡å­—..."></div>
  </div>
</div>







<div id="replaceModal" class="modal">

  <div class="modal-content-container">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="replaceTitle">å–ä»£æ–‡æœ¬</h2>
      <div class="input-group">
        <label for="replace">å–ã€€ä»£ï¼š</label>
        <input type="text" id="replace" name="replace">
      </div>
      <div class="input-group">
        <label for="replaceWith">å–ä»£ç‚ºï¼š</label>
        <input type="text" id="replaceWith" name="replaceWith">
      </div>
      <div class="input-group">
        <label for="useRegex">æ­£ã€€å‰‡ï¼š</label>
        <input type="checkbox" id="useRegex" name="useRegex" checked>
        <select id="regexCharsReplace" class="regexChars">
          <option value="">æ­£å‰‡å­—å…ƒ</option>
          <option value="^">^ é–‹é ­ã€å¦å®š</option>
          <option value="$">$ çµå°¾ã€æŒ‡å®š$1</option>
          <option value="*">* é›¶æˆ–å¤šæ¬¡</option>
          <option value="+">+ ä¸€æˆ–å¤šæ¬¡</option>
          <option value="?">? é›¶æˆ–ä¸€æ¬¡</option>
          <option value=".">. ä»»ä¸€å­—å…ƒ</option>
          <option value="(">( å·¦åœ“</option>
          <option value=")">) å³åœ“</option>
          <option value="()">() é›†åˆ(å«) (pattern)</option>
          <option value="(?:)">(?:) é›†åˆ(ä¸å«) x(?:pattern) é…x</option>
          <option value="(?=)">(?=) å…¶å¾Œç‚º x(?=y) é…x</option>
          <option value="(?!)">(?!) å…¶å¾Œé x(?!y) é…x</option>
          <option value="(?<=)">(?<=) å…¶å‰ç‚º (?<=y)x é…x</option>
          <option value="(?&lt;!)">(?&lt;!) å…¶å‰é (?&lt;!y)x é…x</option>
          <option value="|">| æˆ– x|y</option>
          <option value="{}">{ } æ¬¡æ•¸</option>
          <option value="{,}">{,} è‡³å°‘è‡³å¤š</option>
          <option value="[-]">[-] ç¯„åœå…§</option>
          <option value="[^-]">[^-] ç¯„åœå¤–</option>
          <option value="\d">\d æ•¸å­— [0-9]</option>
          <option value="\D">\D éæ•¸å­— [^0-9]</option>
          <option value="\w">\w å–®è© [A-Za-z0-9_]</option>
          <option value="\W">\W éå–®è© [^A-Za-z0-9_]</option>
          <option value="\s">\s ç©ºç™½å­—å…ƒ</option>
          <option value="\S">\S éç©ºç™½å­—å…ƒ</option>
          <option value="\n">\n æ›è¡Œå­—å…ƒ</option>
          <option value="\t">\t è£½è¡¨ç¬¦TAB</option>
          <option value="\b">\b é‚Šç•Œ</option>
          <option value="\">\ åæ–œç·š</option>
          <option value="\1">\1 å¼•ç”¨</option>
          <option value="\2">\2 å¼•ç”¨</option>
          <option value="\3">\3 å¼•ç”¨</option>
          <option value="&lt;">&lt; å·¦å°–</option>
          <option value="&gt;">&gt; å³å°–</option>
          <option value="{h}">{h} æ¼¢å­—</option>
          <option value="{H}">{H} éæ¼¢å­—</option>
          <option value="{b}">{b} å…¨å½¢æ¨™é»</option>
          <option value="{B}">{B} éå…¨å½¢æ¨™é»</option>
          <option value="{bb}">{bb} åŠå½¢æ¨™é»</option>
          <option value="{BB}">{BB} éåŠå½¢æ¨™é»</option>
          <option value="{s}">{s} ç©ºæ ¼èˆ‡Tab</option>
          <option value="{S}">{S} éç©ºæ ¼èˆ‡Tab</option>
          <option value="{BPM}">{BPM} æ³¨éŸ³å¤§</option>
          <option value="{bpm}">{bpm} æ³¨éŸ³å°æ©«</option>
          <option value="{bpm2}">{bpm2} æ³¨éŸ³å°ç›´</option>
        </select>
        <select id="regexCharsReplaceWith" class="regexChars hide">
          <option value="">æ­£å‰‡å­—å…ƒ</option>
          <option value="\n">\n æ›è¡Œå­—å…ƒ</option>
          <option value="\t">\t è£½è¡¨ç¬¦TAB</option>
          <option value="$1">$1 æŒ‡å®š</option>
          <option value="$2">$2 æŒ‡å®š</option>
          <option value="$3">$3 æŒ‡å®š</option>
          <option value="$4">$4 æŒ‡å®š</option>
          <option value="$5">$5 æŒ‡å®š</option>
          <option value="$">$ æŒ‡å®š</option>
          <option value="(">( å·¦åœ“</option>
          <option value=")">) å³åœ“</option>
          <option value="[">[ å·¦æ–¹</option>
          <option value="]">] å³æ–¹</option>
          <option value="{">{ å·¦èŠ±</option>
          <option value="}">} å³èŠ±</option>
          <option value="&lt;">&lt; å·¦å°–</option>
          <option value="&gt;">&gt; å³å°–</option>
        </select>
      </div>
      <button id="cancelButton">å–æ¶ˆ</button>
      <button id="findPreButton">æ‰¾å‰ä¸€å€‹</button>
      <button id="findNextButton">æ‰¾ä¸‹ä¸€å€‹</button>
      <button id="confirmButton">å…¨éƒ¨å–ä»£</button>
    </div>
  </div>
</div>

<script>
let endData;
let replaceWhere = ''; //å–ä»£ä½ç½®

let currentMatchIndex = -1;
let matches = [];

dragElement(document.getElementById("replaceModal"));

function dragElement(element) {
  let pos1 = 0,
    pos2 = 0,
    pos3 = 0,
    pos4 = 0;
  if (document.getElementById("replaceTitle")) {
    document.getElementById("replaceTitle").onmousedown = dragMouseDown;
  } else {
    element.onmousedown = dragMouseDown;
  }

  function dragMouseDown(e) {
    e = e || window.event;
    e.preventDefault();
    pos3 = e.clientX;
    pos4 = e.clientY;
    document.onmouseup = closeDragElement;
    document.onmousemove = elementDrag;
  }

  function elementDrag(e) {
    e = e || window.event;
    e.preventDefault();
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;
    element.style.top = (element.offsetTop - pos2) + "px";
    element.style.left = (element.offsetLeft - pos1) + "px";
  }

  function closeDragElement() {
    document.onmouseup = null;
    document.onmousemove = null;
  }
}







function performSearch() {
  let textArea = document.getElementById('id_A');
  let searchText = document.getElementById('replace').value;
  let text = textArea.value;

  // é‡ç½®æœç´¢ç‹€æ…‹
  currentMatchIndex = -1;
  matches = [];

  if (searchText && text) {
    const regex = new RegExp(searchText, 'gi');
    let match;
    while ((match = regex.exec(text)) !== null) {
      matches.push(match.index);
    }
  }

  highlightMatch();
}


document.getElementById('findPreButton').addEventListener('click', function() {
  if (matches.length > 0) {
    currentMatchIndex = (currentMatchIndex - 1 + matches.length) % matches
      .length;
    highlightMatch();
  }
});

document.getElementById('findNextButton').addEventListener('click', function() {
  if (matches.length > 0) {
    currentMatchIndex = (currentMatchIndex + 1) % matches.length;
    highlightMatch();
  }
});

document.getElementById('replace').addEventListener('input', performSearch);

function highlightMatch() {
  const textArea = document.getElementById('id_A');
  const searchText = document.getElementById('replace').value;

  if (currentMatchIndex >= 0 && currentMatchIndex < matches.length) {
    const start = matches[currentMatchIndex];
    const end = start + searchText.length;
    textArea.focus();
    textArea.setSelectionRange(start, end);
    textArea.scrollTop = textArea.scrollHeight * (start / textArea.value
      .length) - textArea.clientHeight / 2;
  }
}

// é€šç”¨çš„å‡½æ•¸ä¾†è¨ˆç®—æ–‡æœ¬é•·åº¦ï¼Œè™•ç† Unicode å­—ç¬¦
function getLength(txt) {
    return Array.from(txt).length;
}

// é€šç”¨çš„å‡½æ•¸ä¾†çµ±è¨ˆå­—ç¬¦é »ç‡
function countFrequency(text, regex) {
    const matches = text.match(regex) || [];
    const frequencyMap = {};

    matches.forEach(match => {
        if (frequencyMap[match]) {
            frequencyMap[match]++;
        } else {
            frequencyMap[match] = 1;
        }
    });

    return frequencyMap;
}

// é€šç”¨çš„å‡½æ•¸ä¾†æ’åºå’Œæ ¼å¼åŒ–é »ç‡çµ±è¨ˆçµæœ
function formatFrequency(frequencyMap) {
    const sortedEntries = Object.entries(frequencyMap)
        .sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));

    //let result = `æ¬¡æ•¸\t${label}\n`;
	let result = ``;

    sortedEntries.forEach(([item, count]) => {
        result += `${count}\t${item}\n`;
    });

    return result;
}

// é€šç”¨çš„å‡½æ•¸ä¾†ç´¯åŠ çµæœ
function accumulateResults(newResults) {
    const accumulatedText = document.getElementById('id_C').value;
    if (!accumulatedText.trim()) return newResults.map(([char, count]) => `${count}\t${char}`).join('\n');

    const accumulatedLines = accumulatedText.split('\n').map(line => line.split('\t'));
    const accumulatedMap = new Map(accumulatedLines.map(([count, char]) => [char, parseInt(count)]));

    newResults.forEach(([char, count]) => {
        if (accumulatedMap.has(char)) {
            accumulatedMap.set(char, accumulatedMap.get(char) + count);
        } else {
            accumulatedMap.set(char, count);
        }
    });

    const accumulatedEntries = Array.from(accumulatedMap.entries())
        .sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));

    return accumulatedEntries.map(([char, count]) => `${count}\t${char}`).join('\n');
}


function countCharacters(reg) {
    let text = document.getElementById('id_A').value;

	if (text.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		text = allText;
	}

	if ( text.trim() === ''){
		return;
	}
    const chineseRegex = reg;
    const frequencyMap = countFrequency(text, chineseRegex);
    const newResults = Object.entries(frequencyMap);

    let result = formatFrequency(frequencyMap);
    result = accumulateResults(newResults);
    document.getElementById('id_B').value = result;
}

//ç©ºæ ¼è©é » here
function countWords() {
	let reg =/[\S]+/g;	
	countCharacters(reg);
}

// çµ±è¨ˆæ¼¢å­—
function countChineseCharacters() {
	let reg = /[\u3007\u3400-\u4DB5\u4E00-\u9FCB\uE815-\uE864\uD840-\uD87F][\uDC00-\uDFFF]?/g;
	countCharacters(reg);
}

// çµ±è¨ˆæ‹¼éŸ³ here è‹¥é‡åˆ°è²èª¿å­—æ¯æœƒç®—éŒ¯
function countPinyin() {
	let reg = /[\p{L}\p{M}]+([0-9]|[ËŠË‡Ë‹Ë†âº+^])*/gu;
	//æ­£å‰‡è¡¨é”å¼ä¸­çš„ [\p{L}\p{M}] æœƒåŒ¹é…æ‰€æœ‰å­—æ¯ (\p{L}) å’Œæ‰€æœ‰çµ„åˆå­—ç¬¦ï¼ˆä¾‹å¦‚é‡éŸ³ç¬¦è™Ÿï¼Œ\p{M}ï¼‰ï¼Œ+ è¡¨ç¤ºåŒ¹é…ä¸€å€‹æˆ–å¤šå€‹é€™æ¨£çš„å­—ç¬¦ã€‚u æ¨™èªŒå•Ÿç”¨äº† Unicode æ¨¡å¼ã€‚
	countCharacters(reg);
}

// çµ±è¨ˆå¤šéŸ³ç¯€æ‹¼éŸ³ here è‹¥é‡åˆ°è²èª¿å­—æ¯æœƒç®—éŒ¯
function countMultiSyllables() {
    //let reg = /[a-zA-Z]+([0-9]|[ËŠË‡Ë‹Ë†âº+^])*(?:-+|=|[a-zA-Z]+)*([0-9]|[ËŠË‡Ë‹Ë†âº+^])*/g;
	let reg = /[\p{L}\p{M}]+([0-9]|[ËŠË‡Ë‹Ë†âº+^])*(?:-+|=|[\p{L}\p{M}]+)*([0-9]|[ËŠË‡Ë‹Ë†âº+^])*/gu;
	//æ­£å‰‡è¡¨é”å¼ä¸­çš„ [\p{L}\p{M}] æœƒåŒ¹é…æ‰€æœ‰å­—æ¯ (\p{L}) å’Œæ‰€æœ‰çµ„åˆå­—ç¬¦ï¼ˆä¾‹å¦‚é‡éŸ³ç¬¦è™Ÿï¼Œ\p{M}ï¼‰ï¼Œ+ è¡¨ç¤ºåŒ¹é…ä¸€å€‹æˆ–å¤šå€‹é€™æ¨£çš„å­—ç¬¦ã€‚u æ¨™èªŒå•Ÿç”¨äº† Unicode æ¨¡å¼ã€‚
    countCharacters(reg);
}



// çµ±è¨ˆæ¼¢å­—è©
function countChineseWords() {
    let reg = /[\u3007\u3400-\u4DB5\u4E00-\u9FCB\uE815-\uE864\uD840-\uD87F\uDC00-\uDFFF]+/g;
    countCharacters(reg);
}

// çµ±è¨ˆæ¯è¡Œå­—æ•¸
function countLineLengths() {
	let text = document.getElementById('id_A').value;
	if (text.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		text = allText;
	}

	if ( text.trim() === ''){
		return;
	}
    const lines = text.split('\n');
    const newResults = lines.map(line => [line, getLength(line)]);

    //let result = 'å­—æ•¸\tåŸè¡Œæ–‡å­—\n';
	let result = '';
    newResults.forEach(([line, length]) => {
        result += `${length}\t${line}\n`;
    });
    result = accumulateResults(newResults);
    document.getElementById('id_B').value = result;
}

// çµ±è¨ˆå­—æ•¸ï¼ˆç¸½å­—æ•¸ã€æ¼¢å­—æ•¸ã€æ‹¼éŸ³æ•¸ã€æ¨™é»æ•¸ã€æ•¸å­—æ•¸ã€æ®µè½æ•¸ï¼‰
function countTextStatistics() {
    let text = document.getElementById('id_A').value;
	if (text.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		text = allText;
	}

	if ( text.trim() === ''){
		return;
	}

    const chineseRegex = /[\u3007\u3400-\u4DB5\u4E00-\u9FCB\uE815-\uE864\uD840-\uD87F][\uDC00-\uDFFF]?/gu;
    const pinyinRegex = /\b[a-zA-Z]+\d?\b/g;
    const punctuationRegex = /[\p{P}\p{S}]/gu;
    const numberRegex = /\d/g;
    const paragraphRegex = /\n+/g;

    const chineseCount = (text.match(chineseRegex) || []).reduce((acc, char) => acc + getLength(char), 0);
    const pinyinCount = (text.match(pinyinRegex) || []).length;
    const punctuationCount = (text.match(punctuationRegex) || []).length;
    const numberCount = (text.match(numberRegex) || []).length;
    const paragraphCount = text.split(paragraphRegex).length;
    const totalCount = chineseCount + pinyinCount + punctuationCount + numberCount;

    //let result = 'çµ±è¨ˆé …ç›®\tæ•¸å€¼\n';
	let result = '';
    result += `ç¸½å­—æ•¸\t${totalCount}\n`;
    result += `æ¼¢å­—æ•¸\t${chineseCount}\n`;
    result += `æ‹¼éŸ³æ•¸\t${pinyinCount}\n`;
    result += `æ¨™é»æ•¸\t${punctuationCount}\n`;
    result += `æ•¸å­—æ•¸\t${numberCount}\n`;
    result += `æ®µè½æ•¸\t${paragraphCount}\n`;

    document.getElementById('id_B').value = result;
}

// çµ±è¨ˆå¥å­é•·åº¦
function countSentenceLengths() {
    let text = document.getElementById('id_A').value;
	if (text.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		text = allText;
	}

	if ( text.trim() === ''){
		return;
	}
    // ä½¿ç”¨æ­£å‰‡è¡¨é”å¼æ ¹æ“šæ¨™é»ç¬¦è™Ÿä¾†æ–·è¡Œ
    const sentences = text.split(/[\p{P}]/u).map(line => line.trim());

    // éæ¿¾ç©ºè¡Œ
    const filteredSentences = sentences.filter(sentence => sentence.length > 0);

    // è¨ˆç®—æ¯å€‹å¥å­çš„å­—æ•¸
    const sentenceLengths = filteredSentences.map(sentence => [getLength(sentence), sentence]);

    // æŒ‰å­—æ•¸é™åºæ’åº
    sentenceLengths.sort((a, b) => b[0] - a[0] || a[1].localeCompare(b[1]));

    // æ§‹å»ºçµæœå­—ç¬¦ä¸²
    let result = '';
    sentenceLengths.forEach(([length, sentence]) => {
        result += `${length}\t${sentence}\n`;
    });

    // å°‡çµæœè¼¸å‡ºåˆ° id_B
    document.getElementById('id_B').value = result;
}

function showOptions(selectElement) {
    const otherOption = selectElement.querySelector('option[value=""]');
    if (otherOption) {
        otherOption.classList.add('hidden');
    }
}

function resetOptions(selectElement) {
    const otherOption = selectElement.querySelector('option[value=""]');
    if (otherOption) {
        otherOption.classList.remove('hidden');
    }
    selectElement.value = "";
}

function handleDropdownChange(select) {
    const action = select.value;
    if (action && typeof window[action] === 'function') {
        window[action]();
        setTimeout(() => {
            select.value = ""; // å°‡ select å…ƒç´ çš„å€¼é‡è¨­ç‚ºç©ºé¸é …
        }, 500); // å‡è¨­è™•ç†éœ€è¦0.5ç§’ï¼Œæ‚¨å¯ä»¥æ ¹æ“šå¯¦éš›æƒ…æ³èª¿æ•´é€™å€‹æ™‚é–“
    }
}


function clearAllData() {
    const textareas = document.querySelectorAll('textarea');
    textareas.forEach(textarea => {
        textarea.value = '';
    });
}

function clearData(id) {
    document.getElementById(id).value = '';
}

function copyData(id) {
    const dataToCopy = document.getElementById(id);
    dataToCopy.select();
    document.execCommand('copy');
}

function copyDataB() {
    const dataToCopy = document.getElementById('id_B');
    let t = dataToCopy.value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±") || t.startsWith("åƒ…é¡¯ç¤ºå‰100è¡Œ")) {
		let data = resultLines.join('\n');	
		copyToClipboard(data);	
	}else{
		dataToCopy.select();
		document.execCommand('copy');	
	}
}


function copyToClipboard(data) {
    // æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦æ”¯æŒ Clipboard API
    if (navigator.clipboard && window.isSecureContext) {
        // ä½¿ç”¨ Clipboard API è¤‡è£½æ–‡å­—åˆ°å‰ªè²¼ç°¿
        navigator.clipboard.writeText(data).then(() => {
            showToast('è¤‡è£½å®Œæˆ', true, 1500);
        }).catch((err) => {
            showToast('éŒ¯èª¤ï¼è«‹é‡æ–°è¤‡è£½', true, 2000);
        });
    } else {
        // å¦‚æœ Clipboard API ä¸å¯ç”¨ï¼Œå‰‡ä½¿ç”¨ fallback æ–¹æ³•
        fallbackCopyToClipboard(data);
    }
}


function showToast(message, autoDismiss = true, dismissTime = 3000) {
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.innerText = message;
    document.body.appendChild(toast);

    setTimeout(() => toast.classList.add('show'), 100);

    if (autoDismiss) {
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => document.body.removeChild(toast), 500);
        }, dismissTime);
    }
}


function copyDataTo(from_id, to_id) {
    const fromId = document.getElementById(from_id);
	const toId = document.getElementById(to_id);
	toId.value = fromId.value;
	fromId.value = "";
}

function toggleSort(id, direction, e) {
    const isBig = e.getAttribute('sort-big') === 'true';
    sortData(id, direction, isBig ? 'big' : 'small');
    e.setAttribute('sort-big', !isBig);
}

function sortData(id, at, how) {
    const textarea = document.getElementById(id);
    const lines = textarea.value.trim().split('\n');

    // å°‡æ¯è¡Œæ‹†åˆ†æˆæ•¸å­—å’Œæ–‡å­—
    const data = lines.map(line => {
        const [number, text] = line.split('\t');
        return { number: parseFloat(number), text };
    });

    // æ ¹æ“š at åƒæ•¸æ’åº
    data.sort((a, b) => {
        let comparison = 0;
        if (at === 'left') {
            comparison = a.number - b.number;
        } else if (at === 'right') {
            comparison = a.text.localeCompare(b.text, 'zh-Hant'); // ä½¿ç”¨ä¸­æ–‡æ¯”è¼ƒ
        } else {
            console.error(`Invalid sort attribute: ${at}`);
            return;
        }

        // æ ¹æ“š how åƒæ•¸èª¿æ•´æ’åºé †åº
        return how === 'big' ? -comparison : comparison;
    });

    // å°‡æ’åºçµæœé‡æ–°çµ„åˆæˆæ–‡æœ¬ä¸¦è¨­ç½®åˆ° textarea
    const sortedLines = data.map(item => `${item.number}\t${item.text}`);
    textarea.value = sortedLines.join('\n');
}


function sortData(id, at, how) {
    const textarea = document.getElementById(id);
    if (!textarea) {
        console.error(`Textarea with id ${id} not found.`);
        return;
    }

    // ç²å– textarea çš„å€¼ä¸¦æ‹†åˆ†æˆè¡Œ
    const lines = textarea.value.trim().split('\n');

    // å°‡æ¯è¡Œæ‹†åˆ†æˆå·¦é‚Šæ–‡å­—å’Œå³é‚Šæ–‡å­—
    let leftNumbers = true;
    let rightNumbers = true;
    const data = lines.map(line => {
        const [leftText, rightText] = line.split('\t');
        const parsedLeftNumber = parseFloat(leftText);
        const parsedRightNumber = parseFloat(rightText);

        if (isNaN(parsedLeftNumber)) {
            leftNumbers = false;
        }
        if (isNaN(parsedRightNumber)) {
            rightNumbers = false;
        }

        return {
            leftValue: isNaN(parsedLeftNumber) ? leftText : parsedLeftNumber,
            rightValue: isNaN(parsedRightNumber) ? rightText : parsedRightNumber,
            leftText,
            rightText
        };
    });

    // æ ¹æ“š at åƒæ•¸æ’åº
    data.sort((a, b) => {
        let comparison = 0;
        if (at === 'left') {
            if (leftNumbers) {
                comparison = a.leftValue - b.leftValue;
            } else {
                comparison = a.leftText.localeCompare(b.leftText, 'zh-Hant'); // ä½¿ç”¨ä¸­æ–‡æ¯”è¼ƒ
            }
        } else if (at === 'right') {
            if (rightNumbers) {
                comparison = a.rightValue - b.rightValue;
            } else {
                comparison = a.rightText.localeCompare(b.rightText, 'zh-Hant'); // ä½¿ç”¨ä¸­æ–‡æ¯”è¼ƒ
            }
        } else {
            console.error(`Invalid sort attribute: ${at}`);
            return;
        }

        // æ ¹æ“š how åƒæ•¸èª¿æ•´æ’åºé †åº
        return how === 'big' ? -comparison : comparison;
    });

    // å°‡æ’åºçµæœé‡æ–°çµ„åˆæˆæ–‡æœ¬ä¸¦è¨­ç½®åˆ° textarea
    const sortedLines = data.map(item => `${item.leftText}\t${item.rightText}`);
    textarea.value = sortedLines.join('\n');
}









function sortDataA(how) {
    // ç²å– id_A ä¸­çš„æ–‡æœ¬
    const textarea = document.getElementById('id_A');
    const text = textarea.value;

    // åˆ†å‰²æˆè¡Œï¼Œå»é™¤æ¯è¡Œçš„è¡Œé¦–è¡Œå°¾ç©ºæ ¼ï¼Œä¸¦ç§»é™¤ç©ºè¡Œ
    const lines = text.split('\n')
        .map(line => line.trim())
        .filter(line => line !== '');

    // æ’åºè¡Œ
    lines.sort((a, b) => {
        if (how === 'small') {
            return a.localeCompare(b, 'zh-Hant'); // å‡åº
        } else if (how === 'big') {
            return b.localeCompare(a, 'zh-Hant'); // é™åº
        } else {
            console.error(`Invalid sort order: ${how}`);
            return 0;
        }
    });

    // å°‡æ’åºå¾Œçš„æ–‡æœ¬è¼¸å‡ºåˆ°åŸåœ° id_A
    textarea.value = lines.join('\n');
}


function splitTextByPunctuation() {
    let txt = document.getElementById('id_A').value;
	if (txt.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		txt = allText;
	}

	if ( txt.trim() === ''){
		return;
	}

	txt = "\n" + txt + "\n";
	txt = txt.replace(/(\n)([	 ã€€]){1,}/g, "\n");
	txt = txt.replace(/([	 ã€€]){1,}(\n)/g, "\n");

	txt = txt.replace(/(\n)/g, "######\n");

	txt = txt.replace(/([ã€‚ï¼Œã€ï¼›ï¼šï¼ï¼Ÿã€Œã€ã€ã€ï¼ˆï¼‰ã€Šã€‹ã€ˆã€‰ã€”ã€•ã€ã€‘ã€–ã€—ï¸µï¸¶ï¸¹ï¸ºï¸¿ï¹€ï¸½ï¸¾ï¹ï¹‚ï¹ƒï¹„ï½¡ï½¡ï½¡\u3002\uff0c\uff1b\uff1a\uff01\uff1f\u201c\u201d\u300a\u300b\u300e\u300f\u3010\u3011\u2018\u2019\u3014\u3015\uff08\uff09.,;:!?\"\']+)/g, "$1\n");

	txt = txt.replace(/(\d)(\.)(\n)(\d)/g, '$1$2$4');
	txt = txt.replace(/([^\n])(######)/g, "$1\n$2");
	txt = txt.trim();

	id_B.value = txt;
}

function connectText() {
    let txt = document.getElementById('id_A').value;
	if (txt.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		txt = allText;
	}

	if ( txt.trim() === ''){
		return;
	}
	   txt = txt.replace(/(\n)/g, "");
	   txt = txt.replace(/#{6}/g, "\n");
	   txt = txt.trim();
	   document.getElementById('id_B').value = txt;
}


function removeDuplicateLines(to_id) {
    let text = document.getElementById('id_A').value;
	if (text.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		text = allText;
	}

	if ( text.trim() === ''){
		return;
	}
    // åˆ†å‰²æˆè¡Œï¼Œå»é™¤æ¯è¡Œçš„è¡Œé¦–è¡Œå°¾ç©ºæ ¼ï¼Œä¸¦ç§»é™¤ç©ºè¡Œ
    const lines = text.split('\n')
        .map(line => line.trim())
        .filter(line => line !== '');

    // ä½¿ç”¨ Set å»é™¤é‡è¤‡è¡Œ
    const uniqueLines = Array.from(new Set(lines));

	let out = uniqueLines.join('\n');

    document.getElementById(to_id).value = out;
}

function removeDuplicateLinesIdB(){
	removeDuplicateLines('id_B');
}

function convertToFullMark() {

    const halfWidthToFullWidthMap = {
        '!': 'ï¼',
        '(': 'ï¼ˆ',
        ')': 'ï¼‰',
        ',': 'ï¼Œ',
        '.': 'ã€‚',
        ':': 'ï¼š',
        ';': 'ï¼›',
        '?': 'ï¼Ÿ',
        '~': 'ï½'
    };

    const simpleQuoteToTraditionalMap = {
        'â€œ': 'ã€Œ',
        'â€': 'ã€',
        'â€˜': 'ã€',
        'â€™': 'ã€'
    };

    let text = document.getElementById('id_A').value;
	if (text.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		text = allText;
	}

	if ( text.trim() === ''){
		return;
	}

    const output = text.replace(/[\u0021\u0028\u0029\u002C\u002E\u003A\u003B\u003F\u007E]/g, (match, offset) => {
        const prevChar = text[offset - 1] || '';
        const nextChar = text[offset + 1] || '';
        if (isChinese(prevChar) || isChinese(nextChar)) {
            return halfWidthToFullWidthMap[match];
        }
        return match;
    }).replace(/["â€œâ€â€˜â€™]/g, match => simpleQuoteToTraditionalMap[match]);

    document.getElementById('id_B').value = output;

    function isChinese(char) {
        return /[\u3007\u3400-\u4DB5\u4E00-\u9FCB\uE815-\uE864\uD840-\uD87F][\uDC00-\uDFFF]?/.test(char);
    }
}

//ç©ºæ ¼èˆ‡åº•ç·šæ›è¡Œ
function spaceToNewline() {
            // ç²å– id_A å…ƒç´ çš„å€¼
            let text = document.getElementById('id_A').value;
			if (text.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
				text = allText;
			}
            // å°‡ç©ºæ ¼å’Œåº•ç·šæ›¿æ›æˆæ›è¡Œç¬¦è™Ÿ
            const replacedText = text.replace(/[\s_]/g, '\n');
            // å°‡çµæœè¼¸å‡ºåˆ° id_B å…ƒç´ çš„å€¼ä¸­
            document.getElementById('id_B').value = replacedText;
}


function spaceToUnderline() {
    let txt = document.getElementById('id_A').value;
	if (txt.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		txt = allText;
	}

    if (txt.trim() === '') {
        return;
    }

    txt = txt.replace(/([ã€‚ï¼Œã€ï¼›ï¼šï¼ï¼Ÿã€Œã€ã€ã€ï¼ˆï¼‰ã€Šã€‹ã€ˆã€‰ã€”ã€•ã€ã€‘ã€–ã€—ï¸µï¸¶ï¸¹ï¸ºï¸¿ï¹€ï¸½ï¸¾ï¹ï¹‚ï¹ƒï¹„ï½¡ï½¡ï½¡\u3002\uff0c\uff1b\uff1a\uff01\uff1f\u201c\u201d\u300a\u300b\u300e\u300f\u3010\u3011\u2018\u2019\u3014\u3015\uff08\uff09.,;:!?\"\']+)/g, " $1 ");

    // å°‡é€£çºŒçš„åŠå½¢ç©ºæ ¼å’Œå…¨å½¢ç©ºæ ¼æ›¿æ›ç‚ºåº•ç·š
    txt = txt.replace(/[\u0020\u3000]+/g, "_");

    txt = txt.replace(/(\n)(_)+/g, "\n");
    txt = txt.replace(/(_)+(\n)/g, "\n");

    const lines = txt.split('\n')
        .map(line => "_" + line + "_");

    let out = lines.join('\n');
	txt = out.replace(/(__)(\n)/g, "\n");
	txt = txt.replace(/(\n)(__)/g, "\n");
    txt = txt.trim();

    document.getElementById('id_B').value = txt;
}



//å–ä»£æ¨™é»
function replacePunctuation() {
    // å–å¾—è¼¸å…¥æ¡†çš„æ–‡å­—
    let text = document.getElementById('id_A').value;
	if (text.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		text = allText;
	}
    // é¡¯ç¤ºæç¤ºè¦–çª—ï¼Œè®“ä½¿ç”¨è€…è¼¸å…¥è¦æ›¿æ›çš„æ–‡å­—
    const replacementText = prompt("è«‹è¼¸å…¥è¦æ›¿æ›çš„æ–‡å­—ï¼š");

    // æ›¿æ›æ‰€æœ‰æ¨™é»ç¬¦è™Ÿ
    const newText = text.replace(/([ã€‚ï¼Œã€ï¼›ï¼šï¼ï¼Ÿã€Œã€ã€ã€ï¼ˆï¼‰ã€Šã€‹ã€ˆã€‰ã€”ã€•ã€ã€‘ã€–ã€—ï¸µï¸¶ï¸¹ï¸ºï¸¿ï¹€ï¸½ï¸¾ï¹ï¹‚ï¹ƒï¹„ï½¡ï½¡ï½¡\u3002\uff0c\uff1b\uff1a\uff01\uff1f\u201c\u201d\u300a\u300b\u300e\u300f\u3010\u3011\u2018\u2019\u3014\u3015\uff08\uff09.,;:!?\"\'])/g, replacementText);

    // å°‡æ›¿æ›å¾Œçš„æ–‡å­—è¨­ç½®åˆ°å¦ä¸€å€‹è¼¸å…¥æ¡†
    document.getElementById('id_B').value = newText;
}

	const replaceButton2 = document.getElementById("replaceButton2");
    const replaceButton = document.getElementById("replaceButton");
    const replaceModal = document.getElementById("replaceModal");
    const closeModal = document.getElementsByClassName("close")[0];
    const confirmButton = document.getElementById("confirmButton");
    const cancelButton = document.getElementById("cancelButton");
    const undoButton = document.getElementById("undoButton");
    const redoButton = document.getElementById("redoButton");
    const textAreaA = document.getElementById("id_A");
    const regexCharsReplace = document.getElementById("regexCharsReplace");
    const regexCharsReplaceWith = document.getElementById("regexCharsReplaceWith");
    const useRegex = document.getElementById("useRegex");
    const replaceInput = document.getElementById("replace");
    const replaceWithInput = document.getElementById("replaceWith");

    let history = [];
    let redoStack = [];

    function saveHistory() {
        history.push(textAreaA.value);
        if (history.length > 100) {
            history.shift();
        }
        redoStack = [];
    }

    textAreaA.addEventListener('input', saveHistory);
    textAreaA.addEventListener('cut', saveHistory);
    textAreaA.addEventListener('paste', saveHistory);
    textAreaA.addEventListener('keydown', function(event) {
        if (event.key === 'Backspace' || event.key === 'Delete') {
            saveHistory();
        }
    });

	replaceButton.addEventListener('click', () => {
		replaceWhere = 'id_A'; 
		document.getElementById("replaceTitle").innerText = "è¼¸å…¥åŸåœ°å–ä»£";
		toggleModal(true);
	});
	replaceButton2.addEventListener('click', () => {
		replaceWhere = 'id_B'; 
		document.getElementById("replaceTitle").innerText = "å–ä»£æ–‡å­—";
		toggleModal(true);
	});

	function replaceFn() {
		replaceWhere = 'id_B'; 
		document.getElementById("replaceTitle").innerText = "å–ä»£æ–‡å­—";
		toggleModal(true);
	}

    closeModal.addEventListener('click', () => toggleModal(false));
    cancelButton.addEventListener('click', () => toggleModal(false));



	function toggleModal(show) {
		replaceModal.classList.toggle('show', show);
		replaceModal.classList.toggle('hide', !show);
		
		if (show) {
			// ç•¶æ¨¡æ…‹æ¡†æ‰“é–‹æ™‚åŸ·è¡Œæœç´¢
			performSearch();
		} else {
			// ç•¶æ¨¡æ…‹æ¡†é—œé–‰æ™‚é‡ç½®æœç´¢ç‹€æ…‹
			currentMatchIndex = -1;
			matches = [];
		}
	}

    confirmButton.addEventListener('click', function (event) {
        event.preventDefault();
        const textAreaB = document.getElementById("id_B");
        let replaceText = replaceInput.value;
        let replaceWithText = replaceWithInput.value;
        const useRegexChecked = useRegex.checked;

        let textA = textAreaA.value;
        let textB;


	replaceText = replaceText.replace(/{h}/g,"[\u3007\u3400-\u4DB5\u4E00-\u9FCB\uE815-\uE864\uD840-\uD87F][\uDC00-\uDFFF]?"); //ä¸­æ–‡æ¼¢å­—;
	//æ¼¢å­—é‚„æœ‰ã€Œğ°£»ã€
	replaceText = replaceText.replace(/\{\^h}|{H}/g,"([!-ã•]|[ï¸°-ï¿­])"); // éä¸­æ–‡æ¼¢å­—;

	replaceText = replaceText.replace(/{mail}/g,"([^@ \t\r\n]+@[^@ \t\r\n]+\\.[^@ \t\r\n]+)");  //e-mailä¿¡ç®± [^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+;
	replaceText = replaceText.replace(/{url}/g,"(((https|http|ftp|rtsp|mms)?:\/\/)([^\\s]+))"); //ç¶²å€ ((https|http|ftp|rtsp|mms)?:\/\/)([^\s]+);
	replaceText = replaceText.replace(/{html}/g,"(<\\s*(\\S+)(\\s[^>]*)?>)"); //HTML <æ¨™è¨˜> <\s*(\S+)(\s[^>]*)?>;
	replaceText = replaceText.replace(/{htmlall}/g,"(<\\s*(\\S+)(\\s[^>]*)?>[\\s\\S]*<\\s*\/\\1\\s*>)"); //HTML <æ¨™è¨˜>...</æ¨™è¨˜> <\s*(\S+)(\s[^>]*)?>[\s\S]*<\s*\/\1\s*>;

	replaceText = replaceText.replace(/{y}/g,"([A-u]+)");
	replaceText = replaceText.replace(/{~}/g,"([A-u]+[1-9])");
	replaceText = replaceText.replace(/{v}/g,"([aeiou])");
	replaceText = replaceText.replace(/{V}/g,"([^aeiou])");

	replaceText = replaceText.replace(/{Az}/g,"([A-Za-z])");
	replaceText = replaceText.replace(/{A9}/g,"([A-Za-z0-9])");
	replaceText = replaceText.replace(/{a9}/g,"([a-z0-9])");
	replaceText = replaceText.replace(/{AZ}/g,"([A-Z])");
	replaceText = replaceText.replace(/{az}/g,"([a-z])");

	replaceText = replaceText.replace(/{\^Az}/g,"([^A-Za-z])");
	replaceText = replaceText.replace(/{\^A9}/g,"([^A-Za-z0-9])");
	replaceText = replaceText.replace(/{\^a9}/g,"([^a-z0-9])");
	replaceText = replaceText.replace(/{\^AZ}/g,"([^A-Z])");
	replaceText = replaceText.replace(/{\^az}/g,"([^a-z])");

	replaceText = replaceText.replace(/{ss}/g,"([ ã€€\\t\\r\\n\\v\\f])");  // æ‰€æœ‰ç©ºç™½å­—å…ƒ;
	replaceText = replaceText.replace(/{s}/g,"([ ã€€\\t\\v])");  // ç©ºæ ¼ã€è£½è¡¨å­—å…ƒ;
	replaceText = replaceText.replace(/{\^ss}|{SS}/g,"([^ ã€€\\t\\r\\n\\v\\f])");  // éæ‰€æœ‰ç©ºç™½å­—å…ƒ;
	replaceText = replaceText.replace(/{\^s}|{S}/g,"([ ã€€\\t\\v])");  // éç©ºæ ¼ã€è£½è¡¨å­—å…ƒ;

	replaceText = replaceText.replace(/{biaodian}|{b}/g,"([ã€‚ï¼Œã€ï¼›ï¼šï¼ï¼Ÿã€Œã€ã€ã€ï¼ˆï¼‰ã€Šã€‹ã€ˆã€‰ã€”ã€•ã€ã€‘ã€–ã€—ï¸µï¸¶ï¸¹ï¸ºï¸¿ï¹€ï¸½ï¸¾ï¹ï¹‚ï¹ƒï¹„ï½¡â”€â€¦ï¼ï½ï¹—ï¹™ï¹šï¹ï¹‘ï¹’ï¸°ï¹•ï¹”])");  //æ¨™é»;
	replaceText = replaceText.replace(/{^biaodian}|{^b}|{B}/g,"([^ã€‚ï¼Œã€ï¼›ï¼šï¼ï¼Ÿã€Œã€ã€ã€ï¼ˆï¼‰ã€Šã€‹ã€ˆã€‰ã€”ã€•ã€ã€‘ã€–ã€—ï¸µï¸¶ï¸¹ï¸ºï¸¿ï¹€ï¸½ï¸¾ï¹ï¹‚ï¹ƒï¹„ï½¡â”€â€¦ï¼ï½ï¹—ï¹™ï¹šï¹ï¹‘ï¹’ï¸°ï¹•ï¹”])");  //éæ¨™é»;

	replaceText = replaceText.replace(/{bb}/g,"([,.?!\"\':;])");  //æ¨™é»åŠå½¢;
	replaceText = replaceText.replace(/{\^bb}|{BB}/g,"([^,.?!\"\':;])");  //éæ¨™é»åŠå½¢;

	replaceText = replaceText.replace(/{BPM}/g,"([ã„…-ã†·ËŠË‡Ë‹Ë™])");  // æ³¨éŸ³å¤§;
	replaceText = replaceText.replace(/{bpm}/g,"([î„€-î…Ÿ])");  // æ³¨éŸ³å°æ©«;
	replaceText = replaceText.replace(/{bpm2}/g,"([î…¦-î‰‹])");  // æ³¨éŸ³å°ç›´;


		// Get selected text
		const start = textAreaA.selectionStart;
		const end = textAreaA.selectionEnd;
		const selectedText = textA.substring(start, end);

		if (selectedText.length > 0) {
			// If there is selected text, replace only within the selection
			if (useRegexChecked) {
				const regex = new RegExp(replaceText, 'g');
				replaceWithText = replaceWithText.replace(/\\n/g, '\n').replace(/\\t/g, '\t');
				textB = textA.substring(0, start) + selectedText.replace(regex, replaceWithText) + textA.substring(end);
			} else {
				textB = textA.substring(0, start) + selectedText.split(replaceText).join(replaceWithText) + textA.substring(end);
			}
		} else {
			// If there is no selected text, replace in the whole text
			if (useRegexChecked) {
				const regex = new RegExp(replaceText, 'g');
				replaceWithText = replaceWithText.replace(/\\n/g, '\n').replace(/\\t/g, '\t');
				textB = textA.replace(regex, replaceWithText);
			} else {
				textB = textA.split(replaceText).join(replaceWithText);
			}
		}

		if (replaceWhere == 'id_A') {
			textAreaA.value = textB;
		} else if (replaceWhere == 'id_B') {
			textAreaB.value = textB;
		}
		//performSearch();
	});

    undoButton.addEventListener('click', () => {
        if (history.length > 0) {
            redoStack.push(textAreaA.value);
            textAreaA.value = history.pop();
        }
    });

    redoButton.addEventListener('click', () => {
        if (redoStack.length > 0) {
            history.push(textAreaA.value);
            textAreaA.value = redoStack.pop();
        }
    });

    function insertAtCursor(input, text) {
        const start = input.selectionStart;
        const end = input.selectionEnd;
        input.value = input.value.slice(0, start) + text + input.value.slice(end);
        input.selectionStart = input.selectionEnd = start + text.length;
        input.focus();
    }

    replaceInput.addEventListener('focus', function() {
        regexCharsReplace.classList.remove('hide');
        regexCharsReplaceWith.classList.add('hide');
    });

    replaceWithInput.addEventListener('focus', function() {
        regexCharsReplaceWith.classList.remove('hide');
        regexCharsReplace.classList.add('hide');
    });

    useRegex.addEventListener('change', function() {
        const isChecked = useRegex.checked;
        regexCharsReplace.disabled = !isChecked;
        regexCharsReplaceWith.disabled = !isChecked;
    });

    regexCharsReplace.addEventListener('change', function() {
        insertAtCursor(replaceInput, regexCharsReplace.value);
        regexCharsReplace.value = '';
    });

    regexCharsReplaceWith.addEventListener('change', function() {
        insertAtCursor(replaceWithInput, regexCharsReplaceWith.value);
        regexCharsReplaceWith.value = '';
    });


function swapLeftAndRightIdA(){
	swapLeftAndRight('id_A', 'id_A');
}

function swapLeftAndRightIdB(){
	swapLeftAndRight('id_B', 'id_B');
}

function swapLeftAndRightIdC(){
	swapLeftAndRight('id_C', 'id_C');
}

function swapLeftAndRight(dataId, resultId) {
    // å–å¾— textarea çš„å€¼
    const textA = document.getElementById(dataId).value;

    // å°‡å€¼åˆ†å‰²æˆè¡Œ
    const lines = textA.split('\n');

    // å¾å¾Œå¾€å‰æ‰¾åˆ°ç¬¬ä¸€å€‹éç©ºè¡Œçš„ç´¢å¼•
    let lastIndex = lines.length - 1;
    while (lastIndex >= 0 && lines[lastIndex].trim() === '') {
        lastIndex--;
    }

    // åˆ‡å‰²æ‰æœ€å¾Œé¢çš„ç©ºè¡Œ
    const filteredLines = lines.slice(0, lastIndex + 1);

    // åˆå§‹åŒ–ä¸€å€‹ç©ºé™£åˆ—ä¾†å­˜å„²è½‰æ›å¾Œçš„è¡Œ
    const swappedLines = filteredLines.map(line => {
        // æª¢æŸ¥æ¯è¡Œæ˜¯å¦åŒ…å« \t
        if (!line.includes('\t')) {
            alert("æ¯è¡Œå¿…é ˆåŒ…å«åˆ¶è¡¨ç¬¦ (\\t)");
            throw new Error("æ¯è¡Œå¿…é ˆåŒ…å«åˆ¶è¡¨ç¬¦ (\\t)");
        }

        // å°‡æ¯è¡Œçš„å…§å®¹ç”¨ \t åˆ†å‰²
        const [textA, textB] = line.split('\t');
        // äº¤æ›ä½ç½®ä¸¦åŠ å…¥åˆ°æ–°çš„é™£åˆ—ä¸­
        return `${textB}\t${textA}`;
    });

    // å°‡è½‰æ›å¾Œçš„è¡Œåˆä½µæˆä¸€å€‹å­—ç¬¦ä¸²
    const textB = swappedLines.join('\n');

    // å°‡è½‰æ›å¾Œçš„å­—ç¬¦ä¸²è¼¸å‡ºåˆ° textarea id_B
    document.getElementById(resultId).value = textB;
}




loadCssJs('https://fonts.googleapis.com/icon?family=Material+Icons');

function loadCssJs(url) {
    const extension = url.split('.').pop().toLowerCase();
    if (extension === 'js') {
        const scriptElement = document.createElement('script');
        scriptElement.src = url;
        document.body.appendChild(scriptElement);
    } else if (extension === 'css' || url.includes('fonts.googleapis.com')) {
        const linkElement = document.createElement('link');
        linkElement.rel = 'stylesheet';
        linkElement.href = url;
        document.head.appendChild(linkElement);
    } else {
        console.error('Unsupported file type or URL.');
    }
}


function rubyText2() {
    let text = document.getElementById('id_A').value;
	if (text.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		text = allText;
	}

    let myAll = text;
    let pattern;
	
	// æª¢æŸ¥è¨Šæ¯ä¸­æ˜¯å¦åŒ…å« {æ¼¢å­—/æ‹¼éŸ³}ï¼Œä¸¦è½‰æ›æˆ Ruby 
    //pattern = /\{\s*([^\/}]+)\s*\/\s*([^\/}]+)\s*\}/g; // åŒ¹é… {æ¼¢å­—/æ‹¼éŸ³} æ ¼å¼çš„æ­£å‰‡è¡¨é”å¼
	pattern = /\{\s*(?:ruby\s*:)?\s*([^\/}]+)\s*\/\s*([^\/}]+)\s*\}/g;

    if (myAll.match(pattern)) {
        myAll = myAll.replace(pattern, function(match, p1, p2) {

            var chineseCharacters = Array.from(p1.trim()); // ç§»é™¤é€—è™Ÿä¸¦è½‰ç‚ºé™£åˆ—
            var pinyinWithSpaces = p2.replace(/,/g, ' , '); // åœ¨é€—è™Ÿå‰å¾ŒåŠ ç©ºæ ¼

			 //pinyinWithSpaces = replaceArr12(pinyinWithSpaces, kasuPinyinBpmArr);
			// here 
			// kasuPinyinToBpm(w)
            var pinyinArray = pinyinWithSpaces.trim().split(/\s+/);
            let rubyText = '';
            let chineseIndex = 0;
            for (let i = 0; i < pinyinArray.length; i++) {
                // å¦‚æœ pinyin æ˜¯ - æˆ– -- ï¼Œå‰‡è·³éï¼Œä¸è™•ç†
                if (pinyinArray[i] === '-' || pinyinArray[i] === '--' || pinyinArray[i] === '=') continue;
                const chinesePart = chineseCharacters.slice(chineseIndex, chineseIndex + pinyinArray[i].split(/[-]+/).length);
                rubyText += `<ruby>${chinesePart.join('')}<rt>${pinyinArray[i]}</rt></ruby>`;
                chineseIndex += chinesePart.length;
            }
            return rubyText;
        });
    }

    document.getElementById('id_B').value = myAll;
	document.getElementById('id_D').innerHTML = myAll;
 }

	document.getElementById('toggle-textarea-c').onclick = function() {
    document.getElementById('id_C').classList.toggle('hidden');
	document.getElementById('smallButtonContainer_C').classList.toggle('hidden');
};

function rubyText() {
    let text = document.getElementById('id_A').value;
    if (text.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
        text = allText;
    }
    let myAll = text;
    let pattern;
    
    // æª¢æŸ¥è¨Šæ¯ä¸­æ˜¯å¦åŒ…å« {æ¼¢å­—/æ‹¼éŸ³}ï¼Œä¸¦è½‰æ›æˆ Ruby 
    pattern = /\{\s*(?:ruby\s*:)?\s*([^\/}]+)\s*\/\s*([^\/}]+)\s*\}/g;
    if (myAll.match(pattern)) {
        myAll = myAll.replace(pattern, function(match, p1, p2) {
            var chineseCharacters = Array.from(p1.trim()); // ç§»é™¤é€—è™Ÿä¸¦è½‰ç‚ºé™£åˆ—
            var pinyinWithSpaces = p2.replace(/,/g, ' , '); // åœ¨é€—è™Ÿå‰å¾ŒåŠ ç©ºæ ¼
            var pinyinArray = pinyinWithSpaces.trim().split(/\s+/);
            let rubyText = '';
            let chineseIndex = 0;
            for (let i = 0; i < pinyinArray.length; i++) {
                // å¦‚æœ pinyin æ˜¯ - æˆ– -- ï¼Œå‰‡è·³éï¼Œä¸è™•ç†
                if (pinyinArray[i] === '-' || pinyinArray[i] === '--' || pinyinArray[i] === '=') continue;
                const chinesePart = chineseCharacters.slice(chineseIndex, chineseIndex + pinyinArray[i].split(/[-]+/).length);
                rubyText += `<ruby>${chinesePart.join('')}<rt>${pinyinArray[i]}</rt></ruby>`;
                chineseIndex += chinesePart.length;
            }
            return rubyText;
        });
    }
    
    // æ–°å¢ï¼šæ”¯æ´ç¬¬ä¸€ç¨®æ ¼å¼ - æ–‡å­—(æ‹¼éŸ³)æ–‡å­—(æ‹¼éŸ³)ï¼Œæ–‡å­—(æ‹¼éŸ³)
    pattern = /([^\(\s]+)\(([^\)]+)\)/g;
    if (myAll.match(pattern)) {
        myAll = myAll.replace(pattern, function(match, chinese, pinyin) {
            return `<ruby>${chinese}<rt>${pinyin}</rt></ruby>`;
        });
    }
    
    // æ–°å¢ï¼šæ”¯æ´ç¬¬äºŒç¨®æ ¼å¼ - æ–‡å­—(æ‹¼éŸ³) æ–‡å­—(æ‹¼éŸ³)ï¼Œæ–‡å­—(æ‹¼éŸ³)  æ–‡å­—(æ‹¼éŸ³)
    // é€™ç¨®æ ¼å¼å¯¦éš›ä¸Šèˆ‡ç¬¬ä¸€ç¨®æ ¼å¼çš„è™•ç†æ–¹å¼ç›¸åŒï¼Œå› ç‚ºæ­£å‰‡è¡¨é”å¼æœƒè‡ªå‹•è™•ç†ç©ºæ ¼
    
    document.getElementById('id_B').value = myAll;
    document.getElementById('id_D').innerHTML = myAll;
}

	document.getElementById('toggle-textarea-c').onclick = function() {
    document.getElementById('id_C').classList.toggle('hidden');
    document.getElementById('smallButtonContainer_C').classList.toggle('hidden');
};

		
function combineCharacter() {
	// å¤§\tai å®¶\gav å¥½hox ä¾†\lois å°\leeu
	// ä»¥\tå·¦é‚Šæ¼¢å­—ä¸€å­—ä¸€å­—èˆ‡æ‹¼éŸ³ç›¸ä½µ
    let input = document.getElementById('id_A').value;
	if (input.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		text = allText;
	}

    const lines = input.split('\n');
    let output = '';
	let chineseLength = 0;
	let pinyinLength = 0;
	let exactLength = "";

    lines.forEach(line => {
        if (line.trim() === '' || line.trim() === '\t') {
            output += line + '\n'; // ä¿ç•™ç©ºè¡Œå’Œç©ºçš„tabè¡Œ
            return;
        }
        const [chinese, pinyin] = line.split('\t');
        if (!chinese && !pinyin) {
            output += line + '\n'; // ä¿ç•™ \t è¡Œ
            return;
        }
		let pinyinProcessed = pinyin.replace(/([ã€‚ï¼Œã€ï¼›ï¼šã€ã€‘ã€Œã€ã€ã€ï¼ˆï¼‰â”€ï¼Ÿï¼â€¦ï¹ã€Š ã€‹ã€ˆ ã€‰ï¼¿ï¼â€”ï½~ï¼\(\)\[\]{}\/,.?;:!"'â€œâ€â€˜â€™Â·])/g, ' $1 ')
                                          .replace(/\s+/g, ' ').trim();




		pinyinProcessed = pinyinProcessed.replace(/(=)/g, ' =').replace(/(-+)/g, ' $1').replace(/( )+/g, ' ').trim(); 
        const chineseChars = Array.from(chinese.replace(/[\s|_]+/g, ''));
        const pinyinParts = pinyinProcessed.split(' ');

        let pinyinIndex = 0;
        chineseChars.forEach(char => {
            if (char.trim() !== '') {
                output += char + '\\' + (pinyinParts[pinyinIndex] || '') + ' ';
                pinyinIndex++;
            }
        });
		chineseLength = chineseChars.length;
		pinyinLength = pinyinParts.length;
		if(chineseLength == pinyinLength){
			exactLength = "";		
		}else{
			exactLength = chineseLength + '\\' + pinyinLength;			
		}

        output += '\t' + exactLength + '\n';
    });

    document.getElementById('id_B').textContent = output.trim();
}


function combineWords() {
	// å¤§å®¶å¥½\tai gav hox_ä¾†\lois_å°\leeu
	// ä»¥\tå·¦é‚Šæ¼¢å­—è©åˆ†çµ„ï¼Œä½†ä»¥è©èˆ‡æ‹¼éŸ³ç›¸ä½µ
    let input = document.getElementById('id_A').value;
	if (input.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		input = allText;
	}

    const lines = input.split('\n');
    let output = '';
	let chineseLength = 0;
	let pinyinLength = 0;
	let exactLength = "";

    lines.forEach(line => {
        if (line.trim() === '' || line.trim() === '\t') {
            output += line + '\n'; // ä¿ç•™ç©ºè¡Œå’Œç©ºçš„tabè¡Œ
            return;
        }

        // åˆ†é›¢æ¼¢å­—å’Œæ‹¼éŸ³éƒ¨åˆ†
        const [chinesePart, pinyinPart] = line.split('\t');
        if (!chinesePart && !pinyinPart) {
            output += line + '\n'; // ä¿ç•™ \t è¡Œ
            return;
        }

        // è™•ç†æ¼¢å­—éƒ¨åˆ†ï¼Œå°‡å¤šå€‹ç©ºæ ¼æ›¿æ›ç‚ºä¸€å€‹
        const chineseProcessed = chinesePart.replace(/[\s|_]+/g, ' ').trim();
		chineseLength = Array.from(chineseProcessed.replace(/[\s|_]+/g, '')).length;

        // è™•ç†æ‹¼éŸ³éƒ¨åˆ†ï¼Œå°‡å¤šå€‹ç©ºæ ¼æ›¿æ›ç‚ºä¸€å€‹ï¼Œä¸¦åœ¨æ¨™é»ç¬¦è™Ÿå‰å¾ŒåŠ ä¸Šç©ºæ ¼
        let pinyinProcessed = pinyinPart.replace(/([ã€‚ï¼Œã€ï¼›ï¼šã€ã€‘ã€Œã€ã€ã€ï¼ˆï¼‰â”€ï¼Ÿï¼â€¦ï¹ã€Š ã€‹ã€ˆ ã€‰ï¼¿ï¼â€”ï½~ï¼\(\)\[\]{}\/,.?;:!"'â€œâ€â€˜â€™Â·])/g, ' $1 ').replace(/([-=]+)/g, ' $1').replace(/\s+/g, ' ').trim();

		pinyinLength = pinyinProcessed.split(' ').length;

		const chineseGroups = chineseProcessed.split(' ');
        const pinyinGroups = pinyinProcessed.split(' ');

        // æ§‹å»ºæœ€çµ‚è¼¸å‡º
        let pinyinIndex = 0;
        chineseGroups.forEach(group => {
            let pinyinGroup = '';
			let groupLength= Array.from(group).length;
            for (let i = 0; i < groupLength; i++) {
                // æ·»åŠ å°æ‡‰çš„æ‹¼éŸ³ï¼Œä¸¦åŠ ä¸Š ` ` é€£æ¥
                if (pinyinIndex < pinyinGroups.length) {
                    pinyinGroup += (i > 0 ? ' ' : '') + pinyinGroups[pinyinIndex++];
                }
            }
            output += group + '\\' + pinyinGroup + '_';
        });

		if(chineseLength == pinyinLength){
			exactLength = "";		
		}else{
			exactLength = chineseLength + '\\' + pinyinLength;			
		}
        output += '\t' + exactLength + '\n';
    });
	let result = output.trim().split('\n').map(line => "_" + line).join('\n');
    document.getElementById('id_B').textContent = result;
}


function combineWordsPinyin() {
	// å¤§\tai å®¶\gav å¥½hox_ä¾†\lois_å°\leeu
	// ä»¥\tå·¦é‚Šæ¼¢å­—è©åˆ†çµ„ï¼Œä½†ä»¥è©å…§å­—éŸ³å­—éŸ³ç›¸ä½µ
    let input = document.getElementById('id_A').value;
	if (input.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		input = allText;
	}

    const lines = input.split('\n');
    let output = '';
	let chineseLength = 0;
	let pinyinLength = 0;
	let exactLength = "";

    lines.forEach(line => {
        if (line.trim() === '' || line.trim() === '\t') {
            output += line + '\n'; // ä¿ç•™ç©ºè¡Œå’Œç©ºçš„tabè¡Œ
            return;
        }

        // åˆ†é›¢æ¼¢å­—å’Œæ‹¼éŸ³éƒ¨åˆ†
        const [chinesePart, pinyinPart] = line.split('\t');
        if (!chinesePart && !pinyinPart) {
            output += line + '\n'; // ä¿ç•™ \t è¡Œ
            return;
        }

        // è™•ç†æ¼¢å­—éƒ¨åˆ†ï¼Œå°‡å¤šå€‹ç©ºæ ¼æ›¿æ›ç‚ºä¸€å€‹
        const chineseProcessed = chinesePart.replace(/\s+/g, ' ').trim();
        // è™•ç†æ‹¼éŸ³éƒ¨åˆ†ï¼Œå°‡å¤šå€‹ç©ºæ ¼æ›¿æ›ç‚ºä¸€å€‹ï¼Œä¸¦åœ¨æ¨™é»ç¬¦è™Ÿå‰å¾ŒåŠ ä¸Šç©ºæ ¼
        const pinyinProcessed = pinyinPart.replace(/([ã€‚ï¼Œã€ï¼›ï¼šã€ã€‘ã€Œã€ã€ã€ï¼ˆï¼‰â”€ï¼Ÿï¼â€¦ï¹ã€Š ã€‹ã€ˆ ã€‰ï¼¿ï¼â€”ï½~ï¼\(\)\[\]{}\/,.?;:!"'â€œâ€â€˜â€™Â·])/g, ' $1 ').replace(/([-=]+)/g, ' $1').replace(/\s+/g, ' ').trim();

		chineseLength = Array.from(chineseProcessed.replace(/[\s|_]+/g, '')).length;
		pinyinLength = pinyinProcessed.split(' ').length;

        const chineseGroups = chineseProcessed.split(' ');
        const pinyinGroups = pinyinProcessed.split(' ');

        // æ§‹å»ºæœ€çµ‚è¼¸å‡º
        let pinyinIndex = 0;
        chineseGroups.forEach((group, groupIndex) => {
            if (groupIndex > 0) output += '_'; // çµ„é–“ç”¨ _ éš”é–‹

            Array.from(group).forEach((char, charIndex) => {
                if (charIndex > 0) output += ' '; // å­—é–“ç”¨ç©ºæ ¼éš”é–‹

                // æ·»åŠ å°æ‡‰çš„æ‹¼éŸ³
                output += char + '\\' + (pinyinGroups[pinyinIndex] || '');
                pinyinIndex++;
            });
        });

		if(chineseLength == pinyinLength){
			exactLength = "";		
		}else{
			exactLength = chineseLength + '\\' + pinyinLength;			
		}

        output += ' ' + '\t' + exactLength + '\n';
    });

    document.getElementById('id_B').textContent = output.trim();
}



function combineHyphen() {
	// å¤§å®¶å¥½\tai-gav-hox ä¾†\lois å°\leeu
	// ä»¥\tå³é‚Šå¤šéŸ³ç¯€åˆ†çµ„ï¼Œè©èˆ‡å¤šéŸ³ç¯€æ‹¼éŸ³ç›¸ä½µ
    let input = document.getElementById('id_A').value;
    if (input.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
        input = allText;
    }
    const lines = input.split('\n');
    let output = '';

    // å®šç¾©æ¨™é»ç¬¦è™Ÿæ­£å‰‡è¡¨é”å¼
    const punctuationRegex = /[ã€‚ï¼Œã€ï¼›ï¼šã€ã€‘ã€Œã€ã€ã€ï¼ˆï¼‰â”€ï¼Ÿï¼â€¦ï¹ã€Šã€‹ã€ˆã€‰ï¼¿ï¼â€”ï½~ï¼\â€œ\â€\(\)\[\]{}\/,.?;:!"'""''Â·]/;

    lines.forEach(line => {
        if (line.trim() === '' || line.trim() === '\t') {
            output += line + '\n';
            return;
        }

        const [chinese, pinyin] = line.split('\t').map(part => part.trim());
        if (!chinese || !pinyin) {
            output += line + '\n';
            return;
        }

        let currentOutput = '';

		function splitChineseWithDigits(text) {
		  const chars = Array.from(text);
		  let joinedText = chars.join('Ë‰');
		  joinedText = joinedText.replace(/\d(Ë‰\d)+/g, match => match.replace(/Ë‰/g, ''));
		  const result = joinedText.split('Ë‰');
		  return result;
		}

        // åˆ†åˆ¥è™•ç†æ¼¢å­—å’Œæ‹¼éŸ³
        const chineseChars = splitChineseWithDigits(chinese);
        // å…ˆè™•ç†æ‹¼éŸ³ä¸­çš„æ¨™é»ç¬¦è™Ÿï¼Œç¢ºä¿å‰å¾Œæœ‰ç©ºæ ¼
        let processedPinyin = pinyin;
        // åœ¨æ¨™é»ç¬¦è™Ÿå‰å¾Œæ·»åŠ ç©ºæ ¼ï¼Œä¸¦è™•ç†å¯èƒ½å‡ºç¾çš„å¤šé¤˜ç©ºæ ¼
        processedPinyin = processedPinyin.replace(/([ã€‚ï¼Œã€ï¼›ï¼šã€ã€‘ã€Œã€ã€ã€ï¼ˆï¼‰â”€ï¼Ÿï¼â€¦ï¹ã€Šã€‹ã€ˆã€‰ï¼¿ï¼â€”ï½~ï¼\â€œ\â€\(\)\[\]{}\/,.?;:!"'""''Â·])/g, ' $1 ');
        const pinyinGroups = processedPinyin.split(' ').filter(g => g.length > 0);
        
        let chineseIndex = 0;
        let pinyinIndex = 0;
        
        // è¿½è¹¤å¯¦éš›è¨ˆæ•¸
        let chineseCount = 0;
        let pinyinCount = 0;
        
        while (chineseIndex < chineseChars.length || pinyinIndex < pinyinGroups.length) {
            // è™•ç†æ¼¢å­—éƒ¨åˆ†çš„æ¨™é»ç¬¦è™Ÿ
            while (chineseIndex < chineseChars.length && 
                   punctuationRegex.test(chineseChars[chineseIndex])) {
                currentOutput += chineseChars[chineseIndex] + ' ';
                chineseIndex++;
                chineseCount++;
            }
            
            // è™•ç†æ‹¼éŸ³éƒ¨åˆ†çš„æ¨™é»ç¬¦è™Ÿ
            while (pinyinIndex < pinyinGroups.length && 
                   punctuationRegex.test(pinyinGroups[pinyinIndex])) {
                // ç¢ºä¿æ¨™é»ç¬¦è™Ÿå‰å¾Œæœ‰ç©ºæ ¼
                currentOutput += ` ${pinyinGroups[pinyinIndex]} `;
                pinyinIndex++;
                pinyinCount++;
            }
            
            // è™•ç†æ­£å¸¸çš„æ¼¢å­—å’Œæ‹¼éŸ³é…å°
            if (chineseIndex < chineseChars.length && pinyinIndex < pinyinGroups.length) {
                const currentPinyin = pinyinGroups[pinyinIndex];
                if (!punctuationRegex.test(currentPinyin)) {
                    if (currentPinyin.includes('-')) {
                        // è™•ç†å¸¶é€£å­—ç¬¦çš„æ‹¼éŸ³çµ„
						const charCount = currentPinyin.split(/-+/).length;
                        const relevantChars = chineseChars.slice(chineseIndex, chineseIndex + charCount)
                            .filter(char => !punctuationRegex.test(char))
                            .join('');
                        
                        currentOutput += `${relevantChars}\\${currentPinyin} `;
                        chineseIndex += charCount;
                        chineseCount++;
                    } else {
                        // è™•ç†å–®å€‹æ¼¢å­—å’Œæ‹¼éŸ³
                        currentOutput += `${chineseChars[chineseIndex]}\\${currentPinyin} `;
                        chineseIndex++;
                        chineseCount++;
                    }
                    pinyinIndex++;
                    pinyinCount++;
                } else {
                    // è™•ç†æ¨™é»ç¬¦è™Ÿ
                    currentOutput += ` ${currentPinyin} `;
                    pinyinIndex++;
                    pinyinCount++;
                }
            }
            // è™•ç†å‰©é¤˜çš„æ¼¢å­—
            else if (chineseIndex < chineseChars.length) {
                const currentChar = chineseChars[chineseIndex];
                if (!punctuationRegex.test(currentChar)) {
                    currentOutput += `${currentChar}\\${currentChar} `;
                    chineseCount++;
                } else {
                    currentOutput += currentChar + ' ';
                }
                chineseIndex++;
            }
            // è™•ç†å‰©é¤˜çš„æ‹¼éŸ³
            else if (pinyinIndex < pinyinGroups.length) {
                const currentPinyin = pinyinGroups[pinyinIndex];
                if (!punctuationRegex.test(currentPinyin)) {
                    currentOutput += `${currentPinyin}\\${currentPinyin} `;
                    pinyinCount++;
                } else {
                    currentOutput += ` ${currentPinyin} `;
                }
                pinyinIndex++;
            }
        }
        
        // æ¸…ç†å¤šé¤˜çš„ç©ºæ ¼ï¼Œä½†ä¿ç•™æ¨™é»ç¬¦è™Ÿå‰å¾Œçš„å–®å€‹ç©ºæ ¼
        currentOutput = currentOutput.replace(/\s+/g, ' ').trim();
        
		// æ·»åŠ è¨ˆæ•¸ä¿¡æ¯å’Œæ¯”è¼ƒçµæœæ¨™è¨˜
		let compareMarker = '';
		if (chineseCount > pinyinCount) {
			compareMarker = 'X';
		} else if (chineseCount === pinyinCount) {
			compareMarker = 'O';
		} else {
			compareMarker = 'Y';
		}

		const lengthInfo = `${chineseCount}\\${pinyinCount}`;
		output += currentOutput + '\t' + lengthInfo + '\t' + compareMarker + '\n';
    });

    document.getElementById('id_B').textContent = output.trim();
}











function holoNumberToRoman() {
	// é–©æ•¸å­— è½‰ ç¾…é¦¬å­—
	let t = document.getElementById('id_A').value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		t = allText;
	}

	t = holoNumberToZvs(t);
	t = zvsToRoma(t);
	document.getElementById('id_B').value = t;
}

function holoRomanToNumber() {	
	// é–©ç¾…é¦¬å­— è½‰ æ•¸å­—
	let t = document.getElementById('id_A').value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		t = allText;
	}
	t = romaToZxv(t);
	t = holoZvsToNumber(t);
	document.getElementById('id_B').value = t;
}


function anyZvsToRoma(){
	// ä»»ä½•zvså­—æ¯èª¿èªè¨€ è½‰ ç¾…é¦¬å­—;
	let t = document.getElementById('id_A').value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		t = allText;
	}

	t = zvsToRoma(t);
	document.getElementById('id_B').value = t;
}

function anyRomaToZvs(){
	// ä»»ä½•èªè¨€ç¾…é¦¬å­— è½‰ zvså­—æ¯èª¿
	let t = document.getElementById('id_A').value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		t = allText;
	}

	t = romaToZxv(t);
	document.getElementById('id_B').value = t;
}



function holoNumberToZvs(t) {
	t = t.replace(/([aeiourmn]|nn|ng)(9)/gi, '$1zz')
	t = t.replace(/([aeiourmn]|nn|ng)(1)/gi, '$1')
	t = t.replace(/([aeiourmn]|nn|ng)(2)/gi, '$1z')
	t = t.replace(/([aeiourmn]|nn|ng)(3)/gi, '$1s')
	t = t.replace(/([aeiourmn]|nn|ng)([ptkh])(4)/gi, '$1$2')
	t = t.replace(/([aeiourmn]|nn|ng)(5)/gi, '$1x')
	t = t.replace(/([aeiourmn]|nn|ng)(7)/gi, '$1f')
	t = t.replace(/([aeiourmn]|nn|ng)([ptkh])(8)/gi, '$1$2l')	
	return t;
}

function holoZvsToNumber(t) {
	t = t.replace(/([aeiourmn]|nn|ng)(zz)/gi, '$19')
	t = t.replace(/([aeiourmn]|nn|ng)\b/gi, '$11')
	t = t.replace(/([aeiourmn]|nn|ng)(z)/gi, '$12')
	t = t.replace(/([aeiourmn]|nn|ng)(s)/gi, '$13')
	t = t.replace(/([aeiourmn]|nn|ng)([ptkh])\b/gi, '$1$24')
	t = t.replace(/([aeiourmn]|nn|ng)(x)/gi, '$15')
	t = t.replace(/([aeiourmn]|nn|ng)(f)/gi, '$17')
	t = t.replace(/([aeiourmn]|nn|ng)([ptkh])(l)/gi, '$1$28')	
	return t;
}

function zvsToRoma(t) {
    // å­—æ¯èª¿è½‰ç¾…é¦¬å­—    
t=t.replace(/([MNmn])(n)(g|gh)(zz)\b/g, '$1nÌ‹$3');
t=t.replace(/([MNmn])(n)(g|gh)(z)\b/g, '$1Å„$3');
t=t.replace(/([MNmn])(n)(g|gh)(s)\b/g, '$1Ç¹$3');
t=t.replace(/([MNmn])(n)(g|gh)(x)\b/g, '$1nÌ‚$3');
t=t.replace(/([MNmn])(n)(g|gh)(v)\b/g, '$1Åˆ$3');
t=t.replace(/([MNmn])(n)(g|gh)(f)\b/g, '$1nÌ„$3');
t=t.replace(/([MNmn])(n)(g|gh)(l)\b/g, '$1nÌ$3');

t=t.replace(/(O)([eiouy]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(zz)\b/g, 'Å$2');
t=t.replace(/(O)([eiouy]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(z)\b/g, 'Ã“$2');
t=t.replace(/(O)([eiouy]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(s)\b/g, 'Ã’$2');
t=t.replace(/(O)([eiouy]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(x)\b/g, 'Ã”$2');
t=t.replace(/(O)([eiouy]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(v)\b/g, 'Ç‘$2');
t=t.replace(/(O)([eiouy]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(f)\b/g, 'ÅŒ$2');
t=t.replace(/(O)([eiouy]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(l)\b/g, 'OÌ$2');
t=t.replace(/(o)([eiouy]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(zz)\b/g, 'Å‘$2');
t=t.replace(/(o)([eiouy]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(z)\b/g, 'Ã³$2');
t=t.replace(/(o)([eiouy]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(s)\b/g, 'Ã²$2');
t=t.replace(/(o)([eiouy]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(x)\b/g, 'Ã´$2');
t=t.replace(/(o)([eiouy]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(v)\b/g, 'Ç’$2');
t=t.replace(/(o)([eiouy]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(f)\b/g, 'Å$2');
t=t.replace(/(o)([eiouy]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(l)\b/g, 'oÌ$2');
t=t.replace(/(Yu)((?:n|ng)?)(f)\b/g, 'Ç•$2');
t=t.replace(/(Yu)((?:n|ng)?)(z)\b/g, 'Ç—$2');
t=t.replace(/(Yu)((?:n|ng)?)(v)\b/g, 'Ç™$2');
t=t.replace(/(Yu)((?:n|ng)?)(s)\b/g, 'Ç›$2');
t=t.replace(/(yu)((?:n|ng)?)(f)\b/g, 'Ç–$2');
t=t.replace(/(yu)((?:n|ng)?)(z)\b/g, 'Ç˜$2');
t=t.replace(/(yu)((?:n|ng)?)(v)\b/g, 'Çš$2');
t=t.replace(/(yu)((?:n|ng)?)(s)\b/g, 'Çœ$2');
t=t.replace(/(Y)([iu]{0,1}(?:[mngbdptkh]|nnh|ng|nn)?)(f)\b/g, 'YÌ„$2');
t=t.replace(/(Y)([iu]{0,1}(?:[mngbdptkh]|nnh|ng|nn)?)(v)\b/g, 'YÌŒ$2');
t=t.replace(/(Y)([iu]{0,1}(?:[mngbdptkh]|nnh|ng|nn)?)(z)\b/g, 'YÌ$2');
t=t.replace(/(Y)([iu]{0,1}(?:[mngbdptkh]|nnh|ng|nn)?)(s)\b/g, 'YÌ€$2');
t=t.replace(/(Y)([iu]{0,1}(?:[mngbdptkh]|nnh|ng|nn)?)(x)\b/g, 'YÌ‚$2');
t=t.replace(/(y)([iu]{0,1}(?:[mngbdptkh]|nnh|ng|nn)?)(f)\b/g, 'yÌ„$2');
t=t.replace(/(y)([iu]{0,1}(?:[mngbdptkh]|nnh|ng|nn)?)(v)\b/g, 'yÌŒ$2');
t=t.replace(/(y)([iu]{0,1}(?:[mngbdptkh]|nnh|ng|nn)?)(z)\b/g, 'yÌ$2');
t=t.replace(/(y)([iu]{0,1}(?:[mngbdptkh]|nnh|ng|nn)?)(s)\b/g, 'yÌ€$2');
t=t.replace(/(y)([iu]{0,1}(?:[mngbdptkh]|nnh|ng|nn)?)(x)\b/g, 'yÌ‚$2');
t=t.replace(/(A)([eiou]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(zz)\b/g, 'AÌ‹$2');
t=t.replace(/(A)([eiou]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(z)\b/g, 'Ã$2');
t=t.replace(/(A)([eiou]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(s)\b/g, 'Ã€$2');
t=t.replace(/(A)([eiou]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(x)\b/g, 'Ã‚$2');
t=t.replace(/(A)([eiou]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(v)\b/g, 'Ç$2');
t=t.replace(/(A)([eiou]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(f)\b/g, 'Ä€$2');
t=t.replace(/(A)([eiou]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(l)\b/g, 'AÌ$2');
t=t.replace(/(a)([eiou]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(zz)\b/g, 'aÌ‹$2');
t=t.replace(/(a)([eiou]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(z)\b/g, 'Ã¡$2');
t=t.replace(/(a)([eiou]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(s)\b/g, 'Ã $2');
t=t.replace(/(a)([eiou]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(x)\b/g, 'Ã¢$2');
t=t.replace(/(a)([eiou]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(v)\b/g, 'Ç$2');
t=t.replace(/(a)([eiou]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(f)\b/g, 'Ä$2');
t=t.replace(/(a)([eiou]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(l)\b/g, 'aÌ$2');


t=t.replace(/(E)([eiur]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(zz)\b/g, 'EÌ‹$2');
t=t.replace(/(E)([eiur]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(z)\b/g, 'Ã‰$2');
t=t.replace(/(E)([eiur]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(s)\b/g, 'Ãˆ$2');
t=t.replace(/(E)([eiur]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(x)\b/g, 'ÃŠ$2');
t=t.replace(/(E)([eiur]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(v)\b/g, 'Äš$2');
t=t.replace(/(E)([eiur]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(f)\b/g, 'Ä’$2');
t=t.replace(/(E)([eiur]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(l)\b/g, 'EÌ$2');
t=t.replace(/(e)([eiur]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(zz)\b/g, 'eÌ‹$2');
t=t.replace(/(e)([eiur]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(z)\b/g, 'Ã©$2');
t=t.replace(/(e)([eiur]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(s)\b/g, 'Ã¨$2');
t=t.replace(/(e)([eiur]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(x)\b/g, 'Ãª$2');
t=t.replace(/(e)([eiur]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(v)\b/g, 'Ä›$2');
t=t.replace(/(e)([eiur]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(f)\b/g, 'Ä“$2');
t=t.replace(/(e)([eiur]{0,2}(?:[mngbdptkh]|nnh|ng|nn)?)(l)\b/g, 'eÌ$2');
t=t.replace(/(U)((?:[mngbdptkh]|nnh|ng|nn)?)(zz)\b/g, 'Å°$2');
t=t.replace(/(U)((?:[mngbdptkh]|nnh|ng|nn)?)(z)\b/g, 'Ãš$2');
t=t.replace(/(U)((?:[mngbdptkh]|nnh|ng|nn)?)(s)\b/g, 'Ã™$2');
t=t.replace(/(U)((?:[mngbdptkh]|nnh|ng|nn)?)(x)\b/g, 'Ã›$2');
t=t.replace(/(U)((?:[mngbdptkh]|nnh|ng|nn)?)(v)\b/g, 'Ç“$2');
t=t.replace(/(U)((?:[mngbdptkh]|nnh|ng|nn)?)(f)\b/g, 'Åª$2');
t=t.replace(/(U)((?:[mngbdptkh]|nnh|ng|nn)?)(l)\b/g, 'UÌ$2');
t=t.replace(/(u)((?:[mngbdptkh]|nnh|ng|nn)?)(zz)\b/g, 'Å±$2');
t=t.replace(/(u)((?:[mngbdptkh]|nnh|ng|nn)?)(z)\b/g, 'Ãº$2');
t=t.replace(/(u)((?:[mngbdptkh]|nnh|ng|nn)?)(s)\b/g, 'Ã¹$2');
t=t.replace(/(u)((?:[mngbdptkh]|nnh|ng|nn)?)(x)\b/g, 'Ã»$2');
t=t.replace(/(u)((?:[mngbdptkh]|nnh|ng|nn)?)(v)\b/g, 'Ç”$2');
t=t.replace(/(u)((?:[mngbdptkh]|nnh|ng|nn)?)(f)\b/g, 'Å«$2');
t=t.replace(/(u)((?:[mngbdptkh]|nnh|ng|nn)?)(l)\b/g, 'uÌ$2');
t=t.replace(/(I)([i]{0,1}(?:[mngbdptkhrr]|nnh|ng|nn)?)(zz)\b/g, 'IÌ‹$2');
t=t.replace(/(I)([i]{0,1}(?:[mngbdptkhr]|nnh|ng|nn)?)(z)\b/g, 'Ã$2');
t=t.replace(/(I)([i]{0,1}(?:[mngbdptkhr]|nnh|ng|nn)?)(s)\b/g, 'ÃŒ$2');
t=t.replace(/(I)([i]{0,1}(?:[mngbdptkhr]|nnh|ng|nn)?)(x)\b/g, 'Ã$2');
t=t.replace(/(I)([i]{0,1}(?:[mngbdptkhr]|nnh|ng|nn)?)(v)\b/g, 'Ç$2');
t=t.replace(/(I)([i]{0,1}(?:[mngbdptkhr]|nnh|ng|nn)?)(f)\b/g, 'Äª$2');
t=t.replace(/(I)([i]{0,1}(?:[mngbdptkhr]|nnh|ng|nn)?)(l)\b/g, 'IÌ$2');
t=t.replace(/(i)([i]{0,1}(?:[mngbdptkhr]|nnh|ng|nn)?)(zz)\b/g, 'iÌ‹$2');
t=t.replace(/(i)([i]{0,1}(?:[mngbdptkhr]|nnh|ng|nn)?)(z)\b/g, 'Ã­$2');
t=t.replace(/(i)([i]{0,1}(?:[mngbdptkhr]|nnh|ng|nn)?)(s)\b/g, 'Ã¬$2');
t=t.replace(/(i)([i]{0,1}(?:[mngbdptkhr]|nnh|ng|nn)?)(x)\b/g, 'Ã®$2');
t=t.replace(/(i)([i]{0,1}(?:[mngbdptkhr]|nnh|ng|nn)?)(v)\b/g, 'Ç$2');
t=t.replace(/(i)([i]{0,1}(?:[mngbdptkhr]|nnh|ng|nn)?)(f)\b/g, 'Ä«$2');
t=t.replace(/(i)([i]{0,1}(?:[mngbdptkhr]|nnh|ng|nn)?)(l)\b/g, 'iÌ$2');
t=t.replace(/(M)((?:h)?)(zz)\b/g, 'MÌ‹$2');
t=t.replace(/(M)((?:h)?)(z)\b/g, 'á¸¾$2');
t=t.replace(/(M)((?:h)?)(s)\b/g, 'MÌ€$2');
t=t.replace(/(M)((?:h)?)(x)\b/g, 'MÌ‚$2');
t=t.replace(/(M)((?:h)?)(v)\b/g, 'MÌŒ$2');
t=t.replace(/(M)((?:h)?)(f)\b/g, 'MÌ„$2');
t=t.replace(/(M)((?:h)?)(l)\b/g, 'MÌ$2');
t=t.replace(/(m)((?:h)?)(zz)\b/g, 'mÌ‹$2');
t=t.replace(/(m)((?:h)?)(z)\b/g, 'á¸¿$2');
t=t.replace(/(m)((?:h)?)(s)\b/g, 'mÌ€$2');
t=t.replace(/(m)((?:h)?)(x)\b/g, 'mÌ‚$2');
t=t.replace(/(m)((?:h)?)(v)\b/g, 'mÌŒ$2');
t=t.replace(/(m)((?:h)?)(f)\b/g, 'mÌ„$2');
t=t.replace(/(m)((?:h)?)(l)\b/g, 'mÌ$2');

t=t.replace(/(N)((g|gh)?)(zz)\b/g, 'NÌ‹$2');
t=t.replace(/(N)((g|gh)?)(z)\b/g, 'Åƒ$2');
t=t.replace(/(N)((g|gh)?)(s)\b/g, 'Ç¸$2');
t=t.replace(/(N)((g|gh)?)(x)\b/g, 'NÌ‚$2');
t=t.replace(/(N)((g|gh)?)(v)\b/g, 'Å‡$2');
t=t.replace(/(N)((g|gh)?)(f)\b/g, 'NÌ„$2');
t=t.replace(/(N)((g|gh)?)(l)\b/g, 'NÌ$2');

t=t.replace(/(n)((g|gh)?)(zz)\b/g, 'nÌ‹$2');
t=t.replace(/(n)((g|gh)?)(z)\b/g, 'Å„$2');
t=t.replace(/(n)((g|gh)?)(s)\b/g, 'Ç¹$2');
t=t.replace(/(n)((g|gh)?)(x)\b/g, 'nÌ‚$2');
t=t.replace(/(n)((g|gh)?)(v)\b/g, 'Åˆ$2');
t=t.replace(/(n)((g|gh)?)(f)\b/g, 'nÌ„$2');
t=t.replace(/(n)((g|gh)?)(l)\b/g, 'nÌ$2');

return t;
}



function romaToZxv(t) {
    // ç¾…é¦¬å­—è½‰å­—æ¯èª¿
t=t.replace(/Å([aeioumngptkhbd]{0,5})/g, "O$1zz");
t=t.replace(/Ã“([aeioumngptkhbd]{0,5})/g, "O$1z");
t=t.replace(/Ã’([aeioumngptkhbd]{0,5})/g, "O$1s");
t=t.replace(/Ã”([aeioumngptkhbd]{0,5})/g, "O$1x");
t=t.replace(/Ç‘([aeioumngptkhbd]{0,5})/g, "O$1v");
t=t.replace(/ÅŒ([aeioumngptkhbd]{0,5})/g, "O$1f");
t=t.replace(/OÌ([aeioumngptkhbd]{0,5})/g, "O$1l");
t=t.replace(/Å‘([aeioumngptkhbd]{0,5})/g, "o$1zz");
t=t.replace(/Ã³([aeioumngptkhbd]{0,5})/g, "o$1z");
t=t.replace(/Ã²([aeioumngptkhbd]{0,5})/g, "o$1s");
t=t.replace(/Ã´([aeioumngptkhbd]{0,5})/g, "o$1x");
t=t.replace(/Ç’([aeioumngptkhbd]{0,5})/g, "o$1v");
t=t.replace(/Å([aeioumngptkhbd]{0,5})/g, "o$1f");
t=t.replace(/oÌ([aeioumngptkhbd]{0,5})/g, "o$1l");
t=t.replace(/Ç•([aeioumngptkhbd]{0,5})/g, "Yu$1f");
t=t.replace(/Ç—([aeioumngptkhbd]{0,5})/g, "Yu$1z");
t=t.replace(/Ç™([aeioumngptkhbd]{0,5})/g, "Yu$1v");
t=t.replace(/Ç›([aeioumngptkhbd]{0,5})/g, "Yu$1s");
t=t.replace(/Ç–([aeioumngptkhbd]{0,5})/g, "yu$1f");
t=t.replace(/Ç˜([aeioumngptkhbd]{0,5})/g, "yu$1z");
t=t.replace(/Çš([aeioumngptkhbd]{0,5})/g, "yu$1v");
t=t.replace(/Çœ([aeioumngptkhbd]{0,5})/g, "yu$1s");
t=t.replace(/YÌ„([aeioumngptkhbd]{0,5})/g, "Y$1f");
t=t.replace(/YÌŒ([aeioumngptkhbd]{0,5})/g, "Y$1v");
t=t.replace(/YÌ([aeioumngptkhbd]{0,5})/g, "Y$1z");
t=t.replace(/YÌ€([aeioumngptkhbd]{0,5})/g, "Y$1s");
t=t.replace(/YÌ‚([aeioumngptkhbd]{0,5})/g, "Y$1x");
t=t.replace(/yÌ„([aeioumngptkhbd]{0,5})/g, "y$1f");
t=t.replace(/yÌŒ([aeioumngptkhbd]{0,5})/g, "y$1v");
t=t.replace(/yÌ([aeioumngptkhbd]{0,5})/g, "y$1z");
t=t.replace(/yÌ€([aeioumngptkhbd]{0,5})/g, "y$1s");
t=t.replace(/yÌ‚([aeioumngptkhbd]{0,5})/g, "y$1x");
t=t.replace(/AÌ‹([aeioumngptkhbd]{0,5})/g, "A$1zz");
t=t.replace(/Ã([aeioumngptkhbd]{0,5})/g, "A$1z");
t=t.replace(/Ã€([aeioumngptkhbd]{0,5})/g, "A$1s");
t=t.replace(/Ã‚([aeioumngptkhbd]{0,5})/g, "A$1x");
t=t.replace(/Ç([aeioumngptkhbd]{0,5})/g, "A$1v");
t=t.replace(/Ä€([aeioumngptkhbd]{0,5})/g, "A$1f");
t=t.replace(/AÌ([aeioumngptkhbd]{0,5})/g, "A$1l");
t=t.replace(/aÌ‹([aeioumngptkhbd]{0,5})/g, "a$1zz");
t=t.replace(/Ã¡([aeioumngptkhbd]{0,5})/g, "a$1z");
t=t.replace(/Ã ([aeioumngptkhbd]{0,5})/g, "a$1s");
t=t.replace(/Ã¢([aeioumngptkhbd]{0,5})/g, "a$1x");
t=t.replace(/Ç([aeioumngptkhbd]{0,5})/g, "a$1v");
t=t.replace(/Ä([aeioumngptkhbd]{0,5})/g, "a$1f");
t=t.replace(/aÌ([aeioumngptkhbd]{0,5})/g, "a$1l");
t=t.replace(/EÌ‹([aeioumngptkhbdr]{0,5})/g, "E$1zz");
t=t.replace(/Ã‰([aeioumngptkhbdr]{0,5})/g, "E$1z");
t=t.replace(/Ãˆ([aeioumngptkhbdr]{0,5})/g, "E$1s");
t=t.replace(/ÃŠ([aeioumngptkhbdr]{0,5})/g, "E$1x");
t=t.replace(/Äš([aeioumngptkhbdr]{0,5})/g, "E$1v");
t=t.replace(/Ä’([aeioumngptkhbdr]{0,5})/g, "E$1f");
t=t.replace(/EÌ([aeioumngptkhbdr]{0,5})/g, "E$1l");
t=t.replace(/eÌ‹([aeioumngptkhbdr]{0,5})/g, "e$1zz");
t=t.replace(/Ã©([aeioumngptkhbdr]{0,5})/g, "e$1z");
t=t.replace(/Ã¨([aeioumngptkhbdr]{0,5})/g, "e$1s");
t=t.replace(/Ãª([aeioumngptkhbdr]{0,5})/g, "e$1x");
t=t.replace(/Ä›([aeioumngptkhbdr]{0,5})/g, "e$1v");
t=t.replace(/Ä“([aeioumngptkhbdr]{0,5})/g, "e$1f");
t=t.replace(/eÌ([aeioumngptkhbdr]{0,5})/g, "e$1l");
t=t.replace(/Å°([aeioumngptkhbd]{0,5})/g, "U$1zz");
t=t.replace(/Ãš([aeioumngptkhbd]{0,5})/g, "U$1z");
t=t.replace(/Ã™([aeioumngptkhbd]{0,5})/g, "U$1s");
t=t.replace(/Ã›([aeioumngptkhbd]{0,5})/g, "U$1x");
t=t.replace(/Ç“([aeioumngptkhbd]{0,5})/g, "U$1v");
t=t.replace(/Åª([aeioumngptkhbd]{0,5})/g, "U$1f");
t=t.replace(/UÌ([aeioumngptkhbd]{0,5})/g, "U$1l");
t=t.replace(/Å±([aeioumngptkhbd]{0,5})/g, "u$1zz");
t=t.replace(/Ãº([aeioumngptkhbd]{0,5})/g, "u$1z");
t=t.replace(/Ã¹([aeioumngptkhbd]{0,5})/g, "u$1s");
t=t.replace(/Ã»([aeioumngptkhbd]{0,5})/g, "u$1x");
t=t.replace(/Ç”([aeioumngptkhbd]{0,5})/g, "u$1v");
t=t.replace(/Å«([aeioumngptkhbd]{0,5})/g, "u$1f");
t=t.replace(/uÌ([aeioumngptkhbd]{0,5})/g, "u$1l");
t=t.replace(/IÌ‹([aeioumngptkhbdr]{0,5})/g, "I$1zz");
t=t.replace(/Ã([aeioumngptkhbdr]{0,5})/g, "I$1z");
t=t.replace(/ÃŒ([aeioumngptkhbdr]{0,5})/g, "I$1s");
t=t.replace(/Ã([aeioumngptkhbdr]{0,5})/g, "I$1x");
t=t.replace(/Ç([aeioumngptkhbdr]{0,5})/g, "I$1v");
t=t.replace(/Äª([aeioumngptkhbdr]{0,5})/g, "I$1f");
t=t.replace(/IÌ([aeioumngptkhbdr]{0,5})/g, "I$1l");
t=t.replace(/iÌ‹([aeioumngptkhbdr]{0,5})/g, "i$1zz");
t=t.replace(/Ã­([aeioumngptkhbdr]{0,5})/g, "i$1z");
t=t.replace(/Ã¬([aeioumngptkhbdr]{0,5})/g, "i$1s");
t=t.replace(/Ã®([aeioumngptkhbdr]{0,5})/g, "i$1x");
t=t.replace(/Ç([aeioumngptkhbdr]{0,5})/g, "i$1v");
t=t.replace(/Ä«([aeioumngptkhbdr]{0,5})/g, "i$1f");
t=t.replace(/iÌ([aeioumngptkhbdr]{0,5})/g, "i$1l");
t=t.replace(/MÌ‹([aeioumngptkhbd]{0,5})/g, "M$1zz");
t=t.replace(/á¸¾([aeioumngptkhbd]{0,5})/g, "M$1z");
t=t.replace(/MÌ€([aeioumngptkhbd]{0,5})/g, "M$1s");
t=t.replace(/MÌ‚([aeioumngptkhbd]{0,5})/g, "M$1x");
t=t.replace(/MÌŒ([aeioumngptkhbd]{0,5})/g, "M$1v");
t=t.replace(/MÌ„([aeioumngptkhbd]{0,5})/g, "M$1f");
t=t.replace(/MÌ([aeioumngptkhbd]{0,5})/g, "M$1l");
t=t.replace(/mÌ‹([aeioumngptkhbd]{0,5})/g, "m$1zz");
t=t.replace(/á¸¿([aeioumngptkhbd]{0,5})/g, "m$1z");
t=t.replace(/mÌ€([aeioumngptkhbd]{0,5})/g, "m$1s");
t=t.replace(/mÌ‚([aeioumngptkhbd]{0,5})/g, "m$1x");
t=t.replace(/mÌŒ([aeioumngptkhbd]{0,5})/g, "m$1v");
t=t.replace(/mÌ„([aeioumngptkhbd]{0,5})/g, "m$1f");
t=t.replace(/mÌ([aeioumngptkhbd]{0,5})/g, "m$1l");
t=t.replace(/NÌ‹([aeioumngptkhbd]{0,5})/g, "N$1zz");
t=t.replace(/Åƒ([aeioumngptkhbd]{0,5})/g, "N$1z");
t=t.replace(/Ç¸([aeioumngptkhbd]{0,5})/g, "N$1s");
t=t.replace(/NÌ‚([aeioumngptkhbd]{0,5})/g, "N$1x");
t=t.replace(/Å‡([aeioumngptkhbd]{0,5})/g, "N$1v");
t=t.replace(/NÌ„([aeioumngptkhbd]{0,5})/g, "N$1f");
t=t.replace(/NÌ([aeioumngptkhbd]{0,5})/g, "N$1l");
t=t.replace(/nÌ‹([aeioumngptkhbd]{0,5})/g, "n$1zz");
t=t.replace(/Å„([aeioumngptkhbd]{0,5})/g, "n$1z");
t=t.replace(/Ç¹([aeioumngptkhbd]{0,5})/g, "n$1s");
t=t.replace(/nÌ‚([aeioumngptkhbd]{0,5})/g, "n$1x");
t=t.replace(/Åˆ([aeioumngptkhbd]{0,5})/g, "n$1v");
t=t.replace(/nÌ„([aeioumngptkhbd]{0,5})/g, "n$1f");
t=t.replace(/nÌ([aeioumngptkhbd]{0,5})/g, "n$1l");
return t;
}


function holoNumberToKp() {
//é–©å—èªå°ç¾…123è½‰å®¢èªæ‹¼éŸ³zvsï¼Œgç”¨w;
    let t = document.getElementById('id_A').value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		t = allText;
	}

	t = t.toLowerCase();

	t = t.replace(/\b(p)([aeioun])/g, 'pp$2');
	t = t.replace(/\b(t)([aeioun])/g, 'tt$2');
	t = t.replace(/\b(k)([aeioun])/g, 'kk$2');
	t = t.replace(/\b(g)([aeioun])/g, 'w$2');
	t = t.replace(/\b(j)([aeioun])/g, 'r$2');
	t = t.replace(/\b(b)([aeioun])/g, 'v$2');
	t = t.replace(/\b(tsh)([aeioun])/g, 'c$2');
	t = t.replace(/\b(ts)([aeioun])/g, 'z$2');
	t = t.replace(/\b(ph)([aeioun])/g, 'p$2');
	t = t.replace(/\b(th)([aeioun])/g, 't$2');
	t = t.replace(/\b(kh)([aeioun])/g, 'k$2');
	t = t.replace(/\b(pp)([aeioun])/g, 'b$2');
	t = t.replace(/\b(tt)([aeioun])/g, 'd$2');
	t = t.replace(/\b(kk)([aeioun])/g, 'g$2');

	t = t.replace(/([aeiounr])(p)/g, '$1b');
	t = t.replace(/([aeiounr])(t)/g, '$1d');
	t = t.replace(/([aeiounr])(k)/g, '$1g');

	t = t.replace(/([aeiounrmgbdh])(1)/g, '$1');
	t = t.replace(/([aeiounrmgbdh])(2)/g, '$1s');
	t = t.replace(/([aeiounrmgbdh])(3)/g, '$1v');
	t = t.replace(/([aeiounrmgbdh])(4)/g, '$1x');
	t = t.replace(/([aeiounrmgbdh])(5)/g, '$1z');
	t = t.replace(/([aeiounrmgbdh])(6)/g, '$1ss');
	t = t.replace(/([aeiounrmgbdh])(7)/g, '$1f');
	t = t.replace(/([aeiounrmgbdh])(8)/g, '$1');
	t = t.replace(/([aeiounrmgbdh])(9)/g, '$1zz');

	document.getElementById('id_B').value = t;
}



function rovToRHOOBB() {
//è©”å®‰ç°¡æ‹¼è½‰æ•™æ‹¼
    let t = document.getElementById('id_A').value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		t = allText;
	}

	t = t.replace(/\b(oo)([czvsxf]\b|[Ë‡Ë‹ËŠâºË†^]|\b)/g, 'È«$2');
	t = t.replace(/\b(o)([czvsxf]\b|[Ë‡Ë‹ËŠâºË†^]|\b)/g, 'oo$2');
	t = t.replace(/È«/g, 'o');
	t = t.replace(/(rh)([aeiou])/g, 'r$2');
	t = t.replace(/(bb)([aeiou])/g, 'v$2');
	t = t.replace(/(v)([aeiou])/g, 'bb$2');
	t = t.replace(/(r)([aeiou])/g, 'rh$2');
	t = t.replace(/\b([bpfdtlgkhzcs]|bb|zh|ch|sh|rh)(o)([czvsxf]\b|[Ë‡Ë‹ËŠâºË†^]|\b)/g, '$1oo$3');
	document.getElementById('id_B').value = t;
}




function rhoobbToROV() {
//è©”å®‰æ•™æ‹¼è½‰ç°¡æ‹¼
    let t = document.getElementById('id_A').value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		t = allText;
	}

	t = t.replace(/\b([bpfdtlgkhzcs]|bb|zh|ch|sh|rh)(oo)([czvsxf]\b|[Ë‡Ë‹ËŠâºË†^]|\b)/g, '$1o$3');
    t = t.replace(/(\b)(bb)([aeiou])/gi, '$1v$3');
	t = t.replace(/(\b)(rh)([aeiou])/gi, '$1r$3');
	t = t.replace(/(\b)(o)([czvsxf]\b|[Ë‡Ë‹ËŠâºË†^]|\b)/g, '$1È«$3');
	t = t.replace(/(\b)(oo)([czvsxf]\b|[Ë‡Ë‹ËŠâºË†^]|\b)/g, '$1o$3');
	t = t.replace(/È«/g, 'oo');
	document.getElementById('id_B').value = t;
}

// å°‡ ã€Œçˆ†bau ç™¼fadsã€è½‰æˆã€Œçˆ†ç™¼\bau fadsã€
// å°‡ ã€Œçˆ†\bau ç™¼\fadsã€è½‰æˆã€Œçˆ†ç™¼\bau fadsã€
// å°‡ ã€Œå¤§\tai å®¶\gavã€çˆ†\bau ç™¼\fadsã€è½‰æˆã€Œå¤§å®¶\tai gavã€çˆ†ç™¼\bau fadsã€
function arrangeText() {
            const inputText = document.getElementById('id_A').value;
    
    // å°‡è¼¸å…¥æ–‡æœ¬æŒ‰è¡Œåˆ†å‰²ï¼Œç„¶å¾Œè™•ç†æ¯ä¸€è¡Œ
    const result = inputText.split(/\r?\n/).map(line => {
        // å¦‚æœæ˜¯ç©ºè¡Œï¼Œç›´æ¥è¿”å›ç©ºå­—ç¬¦ä¸²
        if (!line.trim()) return '';
        
        // ç”¨æ¨™é»ç¬¦è™Ÿåˆ†å‰²æ–‡æœ¬ä¸¦è™•ç†æ¯å€‹æ®µè½
        return line.split(/([ï¼›ã€ï¼Œï¼šã€‚ï¼])/g).map(segment => {
            // å¦‚æœæ˜¯ç©ºå­—ç¬¦ä¸²æˆ–æ¨™é»ç¬¦è™Ÿï¼Œç›´æ¥è¿”å›
            if (!segment.trim() || /^[ï¼›ã€ï¼Œï¼šã€‚ï¼]$/.test(segment)) return segment;
            
            // è™•ç†åŒ…å«æ¼¢å­—å’Œæ‹¼éŸ³çš„æ®µè½
            const pairs = segment.trim().split(/\s+/);
            if (!pairs[0]) return '';
            
            const characters = [];
            const pronunciations = [];
            
            // è™•ç†æ¯ä¸€å°æ¼¢å­—å’Œæ‹¼éŸ³
            pairs.forEach(pair => {
                // è™•ç†å–®å€‹é…å°
                let char, pron;
                
                // æª¢æŸ¥æ˜¯å¦åŒ…å«åæ–œç·š
                if (pair.includes('\\')) {
                    [char, pron] = pair.split('\\');
                } else {
                    // å¦‚æœæ²’æœ‰åæ–œç·šï¼Œå°‹æ‰¾ç¬¬ä¸€å€‹æ‹¼éŸ³å­—æ¯çš„ä½ç½®
                    const pinyinStart = pair.search(/[a-zA-Z]/);
                    if (pinyinStart !== -1) {
                        char = pair.slice(0, pinyinStart);
                        pron = pair.slice(pinyinStart);
                    }
                }
                
                if (char && pron) {
                    characters.push(char);
                    pronunciations.push(pron);
                }
            });
            
            // å¦‚æœæœ‰æœ‰æ•ˆçš„å­—ç¬¦å’Œæ‹¼éŸ³ï¼Œè¿”å›çµ„åˆå¾Œçš„çµæœ
            return characters.length > 0 ? 
                `${characters.join('')}\\${pronunciations.join(' ')}` : '';
        }).join('');
    }).join('\n');
    
            document.getElementById('id_B').value = result;
}


// å°‡ã€Œçˆ†ç™¼\bau fadsã€ è½‰æˆã€Œçˆ†bau ç™¼fadsã€
// å°‡ã€Œçˆ†ç™¼\bau fadsã€ è½‰æˆã€Œçˆ†\bau ç™¼\fadsã€
// å°‡ã€Œå¤§å®¶\tai gavã€çˆ†ç™¼\bau fadsã€ è½‰æˆã€Œå¤§\tai å®¶\gavã€çˆ†\bau ç™¼\fadsã€
function reverseArrangeText() {
    // 1. å…ˆç”¨è¡Œåˆ†å‰²
    const lines = document.getElementById('id_A').value.split(/\r?\n/);
    
    const result = lines.map(line => {
        if (!line.trim()) return '';
        
        // 2. åŒè¡Œç”¨æ¨™é»åˆ†å‰²
        const segments = line.split(/([ï¼›ã€ï¼Œï¼šã€])/);
        
        return segments.map(segment => {
            if (/^[ï¼›ã€ï¼Œï¼šã€]$/.test(segment)) return segment;
            if (!segment.trim()) return '';
            
            // æª¢æŸ¥æ˜¯å¦åŒ…å«åæ–œç·š
            if (!segment.includes('\\')) {
                // ä½¿ç”¨æ­£å‰‡è¡¨é”å¼åŒ¹é…æ¼¢å­—
                const hanziRegex = /[\u3007\u3400-\u4DB5\u4E00-\u9FCB\uE815-\uE864\uD840-\uD87F][\uDC00-\uDFFF]?/g;
                const hanziMatches = segment.match(hanziRegex) || [];
                
                // ç§»é™¤æ¼¢å­—ï¼Œå‰©ä¸‹çš„å°±æ˜¯æ‹¼éŸ³
                let remainingText = segment;
                hanziMatches.forEach(hanzi => {
                    remainingText = remainingText.replace(hanzi, '');
                });
                
                // æ¸…ç†æ‹¼éŸ³å­—ä¸²ï¼ˆç§»é™¤å¤šé¤˜ç©ºæ ¼ï¼‰
                const prons = remainingText.trim().split(/\s+/);
                
                // å¦‚æœæ¼¢å­—å’Œæ‹¼éŸ³æ•¸é‡ç›¸åŒï¼ŒåŠ å…¥åæ–œç·š
                if (hanziMatches.length === prons.length) {
                    segment = hanziMatches.join('') + '\\' + prons.join(' ');
                }
            }
            
            // 3. ç”¨åæ–œç·šåˆ†å‰²å–®ä¸€æ®µè½
            let [chars, prons] = segment.trim().split('\\');
            if (!prons) return segment;
            
            // 4. æ¼¢å­—ç”¨ Array.from åˆ†å‰²
            const charArray = Array.from(chars);
            // 5. æ‹¼éŸ³ç”¨ç©ºæ ¼åˆ†å‰²
            const pronArray = prons.split(/\s+/);
            
            // 6. çµ„åˆèµ·ä¾†
            if (charArray.length === pronArray.length) {
                return charArray.map((char, i) => `${char}\\${pronArray[i]}`).join(' ');
            }
            return segment;
        }).join('');
    }).join('\n');
    
    document.getElementById('id_B').value = result;
}

// æŸ¥ç¬¦åˆçš„è©
// åœ¨ id_A åŒ¯å…¥æ–‡å­—ï¼Œä¸€è¡Œä¸€å­—è©ï¼›åœ¨id_C æ”¾è¦æŸ¥çš„è©ï¼Œæœ€çµ‚è¼¸å‡ºåœ¨id_B
function matchText() {
    let myData = [];
    let t = document.getElementById('id_A').value;
    if (t.startsWith('è¼‰å…¥çš„è³‡æ–™å…±')) {
        t = allData.join("\n");
    }
    myData = t.trim().split(/\r\n|\r|\n/);
    
    // ç²å–è¼¸å…¥æ–‡æœ¬
    const inputText = document.getElementById('id_C').value.trim();
    
    // å°‡è¼¸å…¥æ–‡æœ¬æŒ‰è¡Œåˆ†å‰²
    const inputLines = inputText.split('\n');
    
    // å­˜å„²çµæœçš„é™£åˆ—
    const results = [];
    
    // éæ­·æ¯ä¸€è¡Œè¼¸å…¥
    inputLines.forEach(line => {
        // å°‹æ‰¾ç¬¦åˆå‰ç¶´çš„æ•¸æ“šé …
        const matchedItems = myData.filter(dataItem => {
            return dataItem.startsWith(line);
        });
        
        // å¦‚æœæ‰¾åˆ°åŒ¹é…é …
        if (matchedItems.length > 0) {
            // å°‡åŸå§‹è¼¸å…¥èˆ‡åŒ¹é…çš„é …ç›®çµ„åˆæˆå–®è¡Œå­—ä¸²
            results.push(`${line}\t${matchedItems.join('ã€')}`);
        } else {
            results.push(line);
        }
    });
    
    // å°‡çµæœé¡¯ç¤ºåœ¨è¼¸å‡ºå€ï¼Œç¢ºä¿æ˜¯å–®è¡Œè¼¸å‡º
    document.getElementById('id_B').value = results.join('\n');
}

function matchData() {
            // å–å¾—è¼¸å…¥å€¼
            const dataA = document.getElementById('id_A').value;
            const dataC = document.getElementById('id_C').value;
            
            // å°‡è³‡æ–™Aè½‰æ›æˆæ˜ å°„è¡¨
            const mappingData = {};
            dataA.split('\n').forEach(line => {
                if (line.trim()) {
                    const [key, value] = line.split('\t');
                    if (!mappingData[key]) {
                        mappingData[key] = [];
                    }
                    mappingData[key].push(value);
                }
            });

            // è™•ç†æŸ¥è©¢æ¸…å–®
            const result = [];
            dataC.split('\n').forEach(item => {
                item = item.trim();
                if (item && mappingData[item]) {
                    result.push(`${item}\t${mappingData[item].join('ã€')}`);
                }
            });

            // é¡¯ç¤ºçµæœ
            document.getElementById('id_B').value = result.join('\n');
}

function zxvToTone() {
    let t = document.getElementById('id_A').value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		t = allText;
	}
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(z)/gi, '$1$2ËŠ');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(x)/gi, '$1$2Ë†');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(v)/gi, '$1$2Ë‡');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(s)/gi, '$1$2Ë‹');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(f)/gi, '$1$2âº');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(c)/gi, '$1$2');
	document.getElementById('id_B').value = t;
}

function zxvToneToOriginal() {
    let t = document.getElementById('id_A').value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		t = allText;
	}

	t = t.replace(/([aeioumngbdzvsxfc])(=)([a-z])/gi, '$1-$3');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])([zvsxc])([zvsxfc])/gi, '$1$2$3');
	t = t.replace(/([a-z]{0,4})([mngbdgaeiou])([cf])/gi, '$1$2');	
	document.getElementById('id_B').value = t;
}

function zxvToneToChange() {
    let t = document.getElementById('id_A').value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		t = allText;
	}

	t = t.replace(/([aeioumngbdzvsxfc])(=)([a-z])/gi, '$1-$3');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])([zvsxc])([zvsxfc])/gi, '$1$2$4');
	t = t.replace(/([a-z]{0,4})([mngbdgaeiou])([c])/gi, '$1$2');
	document.getElementById('id_B').value = t;
}


function zxvToneToChangeOral() {
    // è©”å®‰æœ¬è®ŠéŸ³è½‰åˆéŸ³ï¼Œåˆå£èªä½†ä¸åˆå­—æ•¸
    let t = document.getElementById('id_A').value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		t = allText;
	}

	t = zxvToneToChangeOralFn(t);
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])([zvsxc])([zvsxfc])/gi, '$1$2$4');
	t = t.replace(/([a-z]{0,4})([mngbdgaeiou])([c])/gi, '$1$2');
    // å°‡çµæœå¯«å…¥åˆ°è¼¸å‡ºæ¡†
    document.getElementById('id_B').value = t;
}

function zxvToneToChangeOralFn(t) {
    // è©”å®‰æœ¬è®ŠéŸ³è½‰åˆéŸ³ï¼Œåˆå£èªä½†ä¸åˆå­—æ•¸
    // å»ºç«‹åŸéŸ³åˆ°åˆéŸ³çš„å°æ‡‰æ˜ å°„
let kasuOral = `
taif-ciensf=haf-ngidzc	taif-cia-ngid
fanxv=heemsf-viens	fanv-teemf-viens
cinv=gav-miv-gungv	ciangv-miv-gungv
ciensf=haf-ngidzc	cia-ngid
cidzc=censf-teebz	ciens-teebz
cinv=gav-miv-pos	ciangv-miv-pos
cinv=gav-miv-mas	ciangv-miv-mas
losf-vuzc=zongv	lof-vud-zongv
fixv=pienf-teus	fenv-teus
chav=lienxv-pun	chienv-pun
zoxv=ridzc=ha	zua
lizv-ziazc=vi	liv-zi
gazv-ziazc=vi	gav-zi
zoxv=ridz-ha	zoz-ha
nif-ziazc=vi	nif-zi
duzc=hmzc-fe	dung-fe
dedzc=nginsz	dinz
dedzc=nginsf	dinf
dedzc=ngaisz	daiz
dedzc=ngaisf	daif
cinv=gav-miv	ciangv-miv
dedzc=guisz	duiz
zamxv=rensf	zamv-menf
loisf=kuixf	luif
dedzc=ngins	dins
dedzc=ngais	dais
dedzc=hensz	denz
dedzc=hensf	denf
zamxv=rensf	zamv-menf
dedzc=guisf	duif
loisf=kuix	luix
hef-mv=hef	hef-mv-mef
dedzc=hens	dens
dedzc=guis	duis
he-mv=hecv	he-mev
shixc=dux	shid-dux
shixc=dux	shid-dux
rinv=vuiv	vinv-vuiv
libzc=pos	li-pos
gixc=dov	giof
guanv=hev	guanv-tev
he-mv=he	he-mv-me
fusf=lis	fuif-lis
fusf=kis	fuif-kis
buzc=cis	bud-cis
cinv=gav	ciangv
buzc=cis	bud-cis
gixv=haf	giaf
ziv=gav	ziav
mv=voif	mv-moif
mf=hoxv	mf-mov
m=hoxc	mf-mo
mv=voi	mv-moi
mv=hef	mv-mef
mf=hox	mf-mox
mv=he	mv-me
`;
    
    let mappings = kasuOral.trim().split('\n').map(line => {
        let parts = line.split('\t');
        return [parts[0].trim(), parts[1].trim()];
    });

    // é€ä¸€æ›¿æ›åŸéŸ³ç‚ºåˆéŸ³
    for (let [original, replacement] of mappings) {
        let regex = new RegExp(original, 'g');
        t = t.replace(regex, replacement);
    }
	return t;
}


function zxvToneToChangeOralOld() {
    // è©”å®‰æœ¬è®ŠéŸ³è½‰åˆéŸ³èˆŠè½‰æ–°
    let t = document.getElementById('id_A').value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		t = allText;
	}

    // å»ºç«‹åŸéŸ³åˆ°åˆéŸ³çš„å°æ‡‰æ˜ å°„
let kasuOral = `
taif-ciensfy-haf-ngidzc	taif-ciensf=haf-ngidzc
fanxv-hteemsf-viens	fanxv=heemsf-viens
cinvy-gav-miv-gungv	cinv=gav-miv-gungv
ciensfy-haf-ngidzc	ciensf=haf-ngidzc
cidzcy-censf-teebz	cidzc=censf-teebz
cinvy-gav-miv-pos	cinv=gav-miv-pos
cinvy-gav-miv-mas	cinv=gav-miv-mas
losf-vuzcd-zongv	losf-vuzc=zongv
fixvy-pienf-teus	fixv=pienf-teus
chavy-lienxv-pun	chav=lienxv-pun
zoxvy-ridzcy-ha	zoxv=ridzc=ha
lizv-ziazcy-vi	lizv-ziazc=vi
gazv-ziazcy-vi	gazv-ziazc=vi
zoxvy-ridzc-ha	zoxv=ridz-ha
nif-ziazcy-vi	nif-ziazc=vi
duzcy-hmzc-fe	duzc=hmzc-fe
dedzcy-nginsz	dedzc=nginsz
dedzcy-nginsf	dedzc=nginsf
dedzcy-ngaisz	dedzc=ngaisz
dedzcy-ngaisf	dedzc=ngaisf
cinvy-gav-miv	cinv=gav-miv
dedzcy-guisfz	dedzc=guisz
zamxv-rmensf	zamxv=rensf
loisfy-kuixf	loisf=kuixf
dedzcy-ngins	dedzc=ngins
dedzcy-ngais	dedzc=ngais
dedzcy-hensz	dedzc=hensz
dedzcy-hensf	dedzc=hensf
zamxv-rmens	zamxv=rensf
dedzcy-guif	dedzc=guisf
loisfy-kuix	loisf=kuix
hef-mv-hmef	hef-mv=hef
dedzcy-hens	dedzc=hens
dedzcy-guis	dedzc=guis
he-mv-hmev	he-mv=hecv
shixcd-duxv	shixc=dux
shixcd-dux	shixc=dux
rvinv-vuiv	rinv=vuiv
libizc-pos	libzc=pos
gixy-dovf		gixc=dovf
gixcy-dovf	gixc=dovf
guanv-hev	guanv=hev
hef-mv-hme	he-mv=he
gixcy-dovf	gixc=dov
fuuisf-lis	fusf=lis
fuuisf-kis	fusf=kis
buzcd-cisf	buzc=cis
gixvy-haf	gixv=haf
cinvy-gav	cinv=gav
buzcd-cis	buzc=cis
zivy-gav	ziv=gav
mv-vmoif	mv=voif
mf-hmoxv	mf=hoxv
mf-hmoxc	m=hoxc
mv-vmoi	mv=voi
mv-hmef	mv=hef
mf-hmox	mf=hox
mv-hme	mv=he
`;
    
    let mappings = kasuOral.trim().split('\n').map(line => {
        let parts = line.split('\t');
        return [parts[0].trim(), parts[1].trim()];
    });

    // é€ä¸€æ›¿æ›åŸéŸ³ç‚ºåˆéŸ³
    for (let [original, replacement] of mappings) {
        let regex = new RegExp(original, 'g');
        t = t.replace(regex, replacement);
    }

    // å°‡çµæœå¯«å…¥åˆ°è¼¸å‡ºæ¡†
    document.getElementById('id_B').value = t;
}


function toneToZxv() {
    let t = document.getElementById('id_A').value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		t = allText;
	}

	//è²èª¿çµ±ä¸€è½‰ç‚ºå­—æ¯èª¿;
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(ËŠ)/gi, '$1$2z');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(\Ë†)/gi, '$1$2x');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(Ë‡)/gi, '$1$2v');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(Ë‹)/gi, '$1$2s');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(\+)/gi, '$1$2f');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(Ë‰)/gi, '$1$2c');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(âº)/gi, '$1$2f');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(\^)/gi, '$1$2x');

    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])( Ì)/gi, '$1$2z');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])( Ì‚)/gi, '$1$2x');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])( ÌŒ)/gi, '$1$2v');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])( Ì€)/gi, '$1$2s');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])( Ì„)/gi, '$1$2c');

	document.getElementById('id_B').value = t;
}

function kasuToneOriginalChange() {
    // è©”å®‰å®¢èªè²èª¿æœ¬èª¿è½‰æœ¬è®Šèª¿
    let t = document.getElementById('id_A').value;
    if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
        t = allText;
    }

	//è²èª¿çµ±ä¸€è½‰ç‚ºå­—æ¯èª¿;
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(ËŠ)/gi, '$1$2z');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(\Ë†)/gi, '$1$2x');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(Ë‡)/gi, '$1$2v');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(Ë‹)/gi, '$1$2s');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(\+)/gi, '$1$2f');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(Ë‰)/gi, '$1$2c');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(âº)/gi, '$1$2f');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(\^)/gi, '$1$2x');

    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])( Ì)/gi, '$1$2z');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])( Ì‚)/gi, '$1$2x');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])( ÌŒ)/gi, '$1$2v');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])( Ì€)/gi, '$1$2s');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])( Ì„)/gi, '$1$2c');

    const lines = t.split('\n');
    const transformedLines = lines.map(line => {
        const words = line.trim().split(/\s+/);
        
        // å››å€‹æ‹¼éŸ³çš„æƒ…æ³ï¼šç¬¬1å’Œç¬¬3ç›¸åŒï¼Œç¬¬2å’Œç¬¬4ç›¸åŒï¼Œä¸”å…¨éƒ¨ä»¥xçµå°¾
        if (words.length === 4 && 
            words[0] === words[2] && 
            words[1] === words[3] && 
            words.every(word => word.endsWith('x'))) {
            words[0] += 'c';
            words[1] += 'c';
            words[2] += 'c';
            return words.join(' ');
        }
        
        // å››å€‹æ‹¼éŸ³çš„æƒ…æ³ï¼šç¬¬1å’Œç¬¬3ç›¸åŒï¼Œç¬¬2å’Œç¬¬4ç›¸åŒ
        if (words.length === 4 && 
            words[0] === words[2] && 
            words[1] === words[3]) {
            // ç¬¬2å€‹æ‹¼éŸ³å°¾åŠ c
            words[1] += 'c';
            
            // ç¬¬1å’Œç¬¬3æ‹¼éŸ³æŒ‰ç…§ä¸€èˆ¬è¦å‰‡åŠ å°¾éŸ³
            if (words[0].endsWith('s')) {
                words[0] += 'c';
                words[2] += 'c';
            } else if (words[0].endsWith('z')) {
                words[0] += 'c';
                words[2] += 'c';
            } else if (words[0].endsWith('x')) {
                words[0] += 'c';
                words[2] += 'c';
            } else if (/[mngaeiou]$/.test(words[0])) {
                words[0] += 'f';
                words[2] += 'f';
            }
            
            return words.join(' ');
        }
        
        // ä¸‰å€‹æ‹¼éŸ³éƒ½ç›¸åŒçš„æƒ…æ³
        if (words.length === 3 && words[0] === words[1] && words[1] === words[2]) {
            if (words[0].endsWith('v')) {
                words[0] = words[0].slice(0, -1) + 'vc';
            } else if (/[aeioumng]$/.test(words[0])) {
                words[1] += 'f';
            } else if (/[z]$/.test(words[0]) || /[s]$/.test(words[0]) || /[x]$/.test(words[0])) {
                words[0] += 'c';
                words[1] += 'f';
            }
        // ç¬¬äºŒå’Œç¬¬ä¸‰å€‹æ‹¼éŸ³ç›¸åŒï¼Œä½†èˆ‡ç¬¬ä¸€å€‹æ‹¼éŸ³ä¸åŒçš„æƒ…æ³
        } else if (words.length === 3 && words[1] === words[2] && words[0] !== words[1]) {
            // æŒ‰ç…§åªæœ‰å…©å€‹æ‹¼éŸ³çš„è¦å‰‡è™•ç†ç¬¬äºŒå€‹æ‹¼éŸ³
            if (/[zvsx]$/.test(words[1])) {
                words[1] += 'c';
            } else if (/[mngaeiou]$/.test(words[1])) {
                // ä¸è®Š
            } else {
                words[1] += 'f';
            }
            // æŒ‰ç…§åŸºæœ¬è¦å‰‡è™•ç†ç¬¬ä¸€å€‹æ‹¼éŸ³
            if (words[0].endsWith('s')) {
                words[0] += 'f';
            } else if (words[0].endsWith('z')) {
                words[0] += 'c';
            } else if (words[0].endsWith('x')) {
                words[0] += 'v';
            } else if (/[mngaeiou]$/.test(words[0])) {
                words[0] += 'f';
            }
        // ä¸‰å€‹æ‹¼éŸ³éƒ½ä»¥xçµå°¾çš„æƒ…æ³
        } else if (words.length === 3 && words.every(word => word.endsWith('x'))) {
            words[0] = words[0].slice(0, -1) + 'xv';
            words[1] = words[1].slice(0, -1) + 'xc';
        // åªæœ‰å…©å€‹æ‹¼éŸ³ä¸”éƒ½ä»¥xçµå°¾çš„æƒ…æ³
        } else if (words.length === 2 && words[0].endsWith('x') && words[1].endsWith('x')) {
            words[0] = words[0].slice(0, -1) + 'xc';
        // åªæœ‰å…©å€‹æ‹¼éŸ³ä¸”ç›¸åŒçš„æƒ…æ³
        } else if (words.length === 2 && words[0] === words[1]) {
            if (/[zvsx]$/.test(words[0])) {
                words[0] += 'c';
            }
        // å…¶ä»–æƒ…æ³ï¼ˆä¸€èˆ¬è¦å‰‡ï¼‰
        } else {
            // å°æ¯å€‹å–®è©åˆ†åˆ¥è™•ç†
            for (let i = 0; i < words.length; i++) {
                if (words[i].endsWith('s')) {
                    words[i] += 'f';
                } else if (words[i].endsWith('z')) {
                    words[i] += 'c';
                } else if (words[i].endsWith('x')) {
                    words[i] += 'c';  // ä¿®æ”¹ï¼šxçµå°¾æ”¹ç‚ºåŠ cè€Œä¸æ˜¯v
                } else if (/[mngaeiou]$/.test(words[i])) {
                    words[i] += 'f';
                }
            }
        }
        return words.join(' ');
    });
    document.getElementById('id_B').value = transformedLines.join('\n');
}
/*
function kasuToneOriginalChange() {
	// è©”å®‰å®¢èªè²èª¿æœ¬èª¿è½‰æœ¬è®Šèª¿
    let t = document.getElementById('id_A').value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		t = allText;
	}

	//è²èª¿çµ±ä¸€è½‰ç‚ºå­—æ¯èª¿;
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(ËŠ)/gi, '$1$2z');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(\Ë†)/gi, '$1$2x');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(Ë‡)/gi, '$1$2v');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(Ë‹)/gi, '$1$2s');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(\+)/gi, '$1$2f');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(Ë‰)/gi, '$1$2c');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(âº)/gi, '$1$2f');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])(\^)/gi, '$1$2x');

    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])( Ì)/gi, '$1$2z');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])( Ì‚)/gi, '$1$2x');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])( ÌŒ)/gi, '$1$2v');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])( Ì€)/gi, '$1$2s');
    t = t.replace(/([a-z]{0,4})([mngbdgaeiou])( Ì„)/gi, '$1$2c');

	const lines = t.split('\n');

    const transformedLines = lines.map(line => {
        const words = line.trim().split(/\s+/);

        // ä¸‰å€‹æ‹¼éŸ³éƒ½ç›¸åŒçš„æƒ…æ³
        if (words.length === 3 && words[0] === words[1] && words[1] === words[2]) {
            if (words[0].endsWith('v')) {
                words[0] = words[0].slice(0, -1) + 'vc';
            } else if (/[aeioumng]$/.test(words[0])) {
                words[1] += 'f';
            } else if (/[z]$/.test(words[0]) || /[s]$/.test(words[0]) || /[x]$/.test(words[0])) {
                words[0] += 'c';
                words[1] += 'f';
            }
            // ç¬¬äºŒå’Œç¬¬ä¸‰å€‹æ‹¼éŸ³ç›¸åŒï¼Œä½†èˆ‡ç¬¬ä¸€å€‹æ‹¼éŸ³ä¸åŒçš„æƒ…æ³
        } else if (words.length === 3 && words[1] === words[2] && words[0] !== words[1]) {
            // æŒ‰ç…§åªæœ‰å…©å€‹æ‹¼éŸ³çš„è¦å‰‡è™•ç†ç¬¬äºŒå€‹æ‹¼éŸ³
            if (/[zvsx]$/.test(words[1])) {
                words[1] += 'c';
            } else if (/[mngaeiou]$/.test(words[1])) {
                // ä¸è®Š
            } else {
                words[1] += 'f';
            }
            // æŒ‰ç…§åŸºæœ¬è¦å‰‡è™•ç†ç¬¬ä¸€å€‹æ‹¼éŸ³
            words[0] = words[0].replace(/(\b\w*[s]\b)\s/g, '$1f ')
                .replace(/(\b\w*[z]\b)\s/g, '$1c ')
                .replace(/(\b\w*[x]\b)\s/g, '$1v ')
                .replace(/(\b\w*[mngaeiou]\b)\s/g, '$1f ');
            // ä¸‰å€‹æ‹¼éŸ³éƒ½ä»¥xçµå°¾çš„æƒ…æ³
        } else if (words.length === 3 && words.every(word => word.endsWith('x'))) {
            words[0] = words[0].slice(0, -1) + 'xv';
            words[1] = words[1].slice(0, -1) + 'xc';
            // åªæœ‰å…©å€‹æ‹¼éŸ³ä¸”éƒ½ä»¥xçµå°¾çš„æƒ…æ³
        } else if (words.length === 2 && words[0].endsWith('x') && words[1].endsWith('x')) {
            words[0] = words[0].slice(0, -1) + 'xc';
            // åªæœ‰å…©å€‹æ‹¼éŸ³ä¸”ç›¸åŒçš„æƒ…æ³
        } else if (words.length === 2 && words[0] === words[1]) {
            if (/[zvsx]$/.test(words[0])) {
                words[0] += 'c';
            }
            // å…¶ä»–æƒ…æ³
        } else {
            return words.join(' ')
                .replace(/(\b\w*[s]\b)\s/g, '$1f ')
                .replace(/(\b\w*[z]\b)\s/g, '$1c ')
                .replace(/(\b\w*[x]\b)\s/g, '$1v ')
                .replace(/(\b\w*[mngaeiou]\b)\s/g, '$1f ');
        }
        return words.join(' ');
    });
    document.getElementById('id_B').value = transformedLines.join('\n');
}
*/



function getRandomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
}


function examText() {
    let idA = document.getElementById('id_A').value.trim().split('\n').filter(line => line.trim() !== '');
    let output = '';
    let errors = '';
    let selectedCharsSet = new Set();
    let duplicatedCharsSet = new Set();
    let allLines = [];
    let isTwoColumnFormat = false;

    // æª¢æŸ¥æ˜¯å¦æ˜¯å…©æ¬„æ ¼å¼
    if (idA.length > 0 && idA[0].split('\t').length === 2) {
        isTwoColumnFormat = true;
    }

    idA.forEach(line => {
        let num, chars, pinyin;
        if (isTwoColumnFormat) {
            [chars, pinyin] = line.split('\t');
            num = 0;
        } else {
            [num, chars, pinyin] = line.split('\t');
        }
		chars = chars.replace(/\s+/g, '')

		pinyin = pinyin.replace(/([\s-=])+/g, '_$1')


        let numInt = parseInt(num);
        const charLength = getLength(chars);
        const pinyinArray = pinyin.split('_');
        const pinyinLength = pinyinArray.length;

        if (isTwoColumnFormat || !num || numInt === 0) {
            numInt = getRandomInt(1, charLength);
        }

        if (numInt > charLength) {
            errors += `æ•¸å­—å¤ªå¤§\n${line}\n`;
        } else if (charLength !== pinyinLength) {
            errors += `å­—æ•¸ä¸ç¬¦\n${line}\n`;
        } else {
            const selectedCharIndex = numInt - 1;
            const selectedChar = Array.from(chars)[selectedCharIndex];
            let selectedPinyin = pinyinArray[selectedCharIndex];

            // æª¢æŸ¥æ˜¯å¦æœ‰ç›¸åŒçš„æ¼¢å­—
            if (selectedCharsSet.has(selectedChar)) {
                duplicatedCharsSet.add(line);
                // å°‡å…ˆå‰å‡ºç¾éè©²æ¼¢å­—çš„è¡Œä¹ŸåŠ å…¥éŒ¯èª¤é›†åˆ
                allLines.forEach(prevLine => {
                    let prevNum, prevChars, prevPinyin;
                    if (isTwoColumnFormat) {
                        [prevChars, prevPinyin] = prevLine.split('\t');
                        prevNum = 0;
                    } else {
                        [prevNum, prevChars, prevPinyin] = prevLine.split('\t');
                    }
                    let prevSelectedChar = Array.from(prevChars)[parseInt(prevNum) - 1];
                    if (prevSelectedChar === selectedChar) {
                        duplicatedCharsSet.add(prevLine);
                    }
                });
            } else {
                selectedCharsSet.add(selectedChar);

                // é¸æ“‡ç¬¬ numInt å€‹æ¼¢å­—
                const newChars = Array.from(chars).map((c, index) =>
                    index === selectedCharIndex ? `ã€Œ${c}ã€` : c
                ).join('');

                // é¸æ“‡ç¬¬ numInt å€‹æ‹¼éŸ³
                let pinyinParts = pinyinArray.map((part, index) =>
                    index === selectedCharIndex ? `ã€Œ${part}ã€` : part
                ).join('');

				
				pinyinParts = pinyinParts.replace(/(ã€Œ)(-+)/g, '$2$1');
				pinyinParts = pinyinParts.replace(/( )(ã€Œ)/g, '$2');
				pinyinParts = pinyinParts.replace(/(ã€)( )/g, '$1');
				selectedPinyin = selectedPinyin.replace(/-+/g, '');
				

                // æº–å‚™æ–°çš„è¼¸å‡ºæ ¼å¼
                output += `${numInt}\t${newChars}\t${selectedPinyin.trim()}\t${pinyinParts}\t${selectedChar}\n`;
            }
            allLines.push(line);
        }
    });

    // å°‡æœ‰ç›¸åŒæ¼¢å­—çš„è¡Œæ·»åŠ åˆ°éŒ¯èª¤è¼¸å‡ºä¸­
    if (duplicatedCharsSet.size > 0) {
        errors += `æ¼¢å­—é‡è¤‡\n`;
        duplicatedCharsSet.forEach(line => {
            errors += `${line}\n`;
        });
    }

    document.getElementById('id_B').value = output.trim();
    document.getElementById('id_C').value = errors.trim();
}





function kasuime() {
            let idAValue = document.getElementById('id_A').value.trim();
			let idALines = [];
			if (idAValue.startsWith('è¼‰å…¥çš„è³‡æ–™å…±')) {
               idAValue = allData.join("\n");
            }

			idAValue = idAValue.replace(/\r\n|\r/g, '\n');
			idALines = idAValue.split('\n').filter(line => line.trim() !== '');

			const punctuationRegex = /[ã€‚ï¼Œã€ï¼›ï¼šï¼ï¼Ÿã€Œã€ã€ã€ï¼ˆï¼‰ã€Šã€‹ã€ˆã€‰ã€”ã€•ã€ã€‘ã€–ã€—ï¸µï¸¶ï¸¹ï¸ºï¸¿ï¹€ï¸½ï¸¾ï¹ï¹‚ï¹ƒï¹„ï½¡â”€â€¦ï¼ï½ï¹—ï¹™ï¹šï¹ï¹‘ï¹’ï¸°ï¹•ï¹”]/;
			idALines = idALines.filter(line => !punctuationRegex.test(line));
			// æ’é™¤æœ‰æ¨™é»çš„è¡Œ

			let idALinesNew = idALines.map(line => {
			    const [count, hanzi, pinyin] = line.split('\t');
				let hanziLength = getLength(hanzi);				
				return [count, hanzi, pinyin, hanziLength].join('\t');
			});


			const dataLines = idALinesNew.filter(line => {
			    const [count, hanzi, pinyin, hanziLength] = line.split('\t');
				return hanziLength && hanziLength <= 7;
			});

            const linesSingBata = dataLines.map(line => {
                // æœ¬èª¿æˆæ‹¼;
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                let y = pinyin || '';
                y = y.replace(/oo/g, 'o');
                y = y.replace(/(rh)([aeiou])/gi, 'r$2');
                y = y.replace(/(bb)([aeiou])/gi, 'v$2');
                y = y.replace(/([aeiouyrmngptkbd])([zvsxc])([zvsxfc])/g, '$1$2');
                y = y.replace(/([aeiouyrmngptkbd])(c|f)/g, '$1');
                y = y.replace(/(\p{P})/gu, ' ');
                y = y.replace(/( +|-+|=)/g, ' ');
                return [count, hanzi, y, hanziLength].join('\t');
            });

            const linesSingConbineBata = dataLines.filter(line => {
                // æˆæ‹¼åˆéŸ³å­—
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                return pinyin && pinyin.includes('=');
            }).map(line => {
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                let y = pinyin || '';
				y = zxvToneToChangeOralFn(y);
                y = y.replace(/oo/g, 'o');
                y = y.replace(/(rh)([aeiou])/gi, 'r$2');
                y = y.replace(/(bb)([aeiou])/gi, 'v$2');
                y = y.replace(/([aeiouyrmngptkbd])([zvsxc])([zvsxfc])/g, '$1$2');
                y = y.replace(/([aeiouyrmngptkbd])(c|f)/g, '$1');
                y = y.replace(/(\p{P})/gu, ' ');
                y = y.replace(/( +|-+|=)/g, ' ');
                return [count, hanzi, y, hanziLength].join('\t');
            });


            const linesSingJqxBata = dataLines.map(line => {
                // æœ¬èª¿æˆæ‹¼JQX;
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                let y = pinyin || '';
                y = y.replace(/oo/g, 'o');
                y = y.replace(/(rh)([aeiou])/gi, 'r$2');
                y = y.replace(/(bb)([aeiou])/gi, 'v$2');
                y = y.replace(/([aeiouyrmngptkbd])([zvsxc])([zvsxfc])/g, '$1$2');
                y = y.replace(/([aeiouyrmngptkbd])(c|f)/g, '$1');
                y = y.replace(/(\p{P})/gu, ' ');
                y = y.replace(/( +|-+|=)/g, ' ');
				y = y.replace(/(z)(i)/g, 'ji');
				y = y.replace(/(c)(i)/g, 'qi');
				y = y.replace(/(s)(i)/g, 'xi');
                return [count, hanzi, y, hanziLength].join('\t');
            });



            const linesEduBata = dataLines.map(line => {
                // æœ¬èª¿æ•™æ‹¼;
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                let y = pinyin || '';
                y = y.replace(/([aeiouyrmngptkbd])([zvsxc])([zvsxfc])/g, '$1$2');
                y = y.replace(/([aeiouyrmngptkbd])(c|f)/g, '$1');
                y = y.replace(/(\p{P})/gu, ' ');
                y = y.replace(/( +|-+|=)/g, ' ');
                y = y.replace(/(oo)(([zvsx])?)\b/g, 'È«$2');
                y = y.replace(/\b(o)(([zvsxf])?)\b/g, 'oo$2');
                y = y.replace(/È«/g, 'o');
                y = y.replace(/(rh)([aeiou])/gi, 'r$2');
                y = y.replace(/(bb)([aeiou])/gi, 'v$2');
                y = y.replace(/(r)([aeiou])/gi, 'rh$2');
                y = y.replace(/(v)([aeiou])/gi, 'bb$2');
                y = y.replace(/\b([bpfdtlgkhzcs]|bb|zh|ch|sh|rh)(o)([zvsx]?)\b/g, '$1oo$3');
                return [count, hanzi, y, hanziLength].join('\t');
            });

            const linesEduConbineBata = dataLines.filter(line => {
                // æ•™æ‹¼åˆéŸ³å­—
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                return pinyin && pinyin.includes('=');
            }).map(line => {
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                let y = pinyin || '';
                y = y.replace(/([aeiouyrmngptkbd])([zvsxc])([zvsxfc])/g, '$1$2');
                y = y.replace(/([aeiouyrmngptkbd])(c|f)/g, '$1');
                y = y.replace(/(\p{P})/gu, ' ');
                y = y.replace(/( +|-+|=)/g, ' ');
                y = y.replace(/(oo)(([zvsx])?)\b/g, 'È«$2');
                y = y.replace(/\b(o)(([zvsxf])?)\b/g, 'oo$2');
                y = y.replace(/È«/g, 'o');
                y = y.replace(/(rh)([aeiou])/gi, 'r$2');
                y = y.replace(/(bb)([aeiou])/gi, 'v$2');
                y = y.replace(/(r)([aeiou])/gi, 'rh$2');
                y = y.replace(/(v)([aeiou])/gi, 'bb$2');
                y = y.replace(/\b([bpfdtlgkhzcs]|bb|zh|ch|sh|rh)(o)([zvsx]?)\b/g, '$1oo$3');
                return [count, hanzi, y, hanziLength].join('\t');
            });

            const linesEduJqxBata = dataLines.map(line => {
                // æœ¬èª¿æ•™æ‹¼JQX;
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                let y = pinyin || '';
                y = y.replace(/([aeiouyrmngptkbd])([zvsxc])([zvsxfc])/g, '$1$2');
                y = y.replace(/([aeiouyrmngptkbd])(c|f)/g, '$1');
                y = y.replace(/(\p{P})/gu, ' ');
                y = y.replace(/( +|-+|=)/g, ' ');
                y = y.replace(/(oo)(([zvsx])?)\b/g, 'È«$2');
                y = y.replace(/\b(o)(([zvsxf])?)\b/g, 'oo$2');
                y = y.replace(/È«/g, 'o');
                y = y.replace(/(rh)([aeiou])/gi, 'r$2');
                y = y.replace(/(bb)([aeiou])/gi, 'v$2');
                y = y.replace(/(r)([aeiou])/gi, 'rh$2');
                y = y.replace(/(v)([aeiou])/gi, 'bb$2');
                y = y.replace(/\b([bpfdtlgkhzcs]|bb|zh|ch|sh|rh)(o)([zvsx]?)\b/g, '$1oo$3');
				y = y.replace(/(z)(i)/g, 'ji');
				y = y.replace(/(c)(i)/g, 'qi');
				y = y.replace(/(s)(i)/g, 'xi');
                return [count, hanzi, y, hanziLength].join('\t');
            });


			const linesSing = Array.from(new Set([...linesSingBata, ...linesSingConbineBata, ...linesSingJqxBata]));           
			const linesEdu = Array.from(new Set([...linesEduBata, ...linesEduConbineBata, ...linesEduJqxBata]));

//=================================

            const linesSa = linesSing.map(line => {
                // æˆæ‹¼æœ¬èª¿è¦è²èª¿
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                let y = pinyin || '';
                y = y.replace(/ /g, '');
                return [count, hanzi, y, hanziLength].join('\t');
            });

            const linesSb = linesSing.filter(line => {
                // æˆæ‹¼äºŒå­—ä»¥ä¸Šå…è²èª¿
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                return hanziLength && hanziLength >= 2;
            }).map(line => {
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                let y = pinyin || '';
                y = y.replace(/([aeiouyrmngptkbd])([zvsx])/g, '$1');
                y = y.replace(/ /g, '');
                return [count, hanzi, y, hanziLength].join('\t');
            });

            let linesSc = linesSing.filter(line => {
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                return hanziLength && hanziLength >= 2;
            }).map(line => {
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                let y = pinyin || '';
                y = y.split(' ').map(x => {
                    if (x.startsWith('tsh')) {
                        return x.slice(0, 3);
                    } else if (x.startsWith('rh') || x.startsWith('zh') || x.startsWith('ch') || x.startsWith('sh') || x.startsWith('ng') || x.startsWith('ts') || x.startsWith('ph') || x.startsWith('th') || x.startsWith('kh') || x.startsWith('bb')) {
                        return x.slice(0, 2);
                    } else {
                        return x.charAt(0);
                    }
                }).join('');
                return [count, hanzi, y, hanziLength].join('\t');
            });


/*
			let linesSd = linesSc.reduce((acc, line) => {
				const [count, hanzi, pinyin, hanziLength] = line.split('\t');
				if (hanziLength == 2) {
					if (!acc[pinyin]) {
						acc[pinyin] = [];
					}
					acc[pinyin].push({ count: parseInt(count), hanzi, line });
				}
				return acc;
			}, {});

			linesSd = Object.values(linesSd).flatMap(group => 
				group.sort((a, b) => b.count - a.count).slice(0, 5).map(item => item.line)
				//2å­—ç°¡ç¢¼å–å‰5å€‹;
			);
*/

			linesSc = linesSc.reduce((acc, line) => {
				const [count, hanzi, pinyin, hanziLength] = line.split('\t');
				if (hanziLength == 2) {
					if (!acc[pinyin]) {
						acc[pinyin] = [];
					}
					acc[pinyin].push({ count: parseInt(count), hanzi, line });
				} else if (hanziLength > 2) {
					// ä¿ç•™æ‰€æœ‰ hanziLength > 2 çš„è¡Œ
					if (!acc['>2']) {
						acc['>2'] = [];
					}
					acc['>2'].push({ count: parseInt(count), hanzi, line });
				}
				return acc;
			}, {});

			const linesSc2 = Object.values(linesSc)
				.flatMap(group => 
					group
					.filter(item => item.hanzi.length == 2)
					.sort((a, b) => b.count - a.count)
					.slice(0, 5)
					.map(item => item.line)
				);

			const linesScMoreThan2 = (linesSc['>2'] || []).map(item => item.line);

			linesSc = [...linesSc2, ...linesScMoreThan2];







//=================================

            const linesEa = linesEdu.map(line => {
                // æ•™æ‹¼æœ¬èª¿è¦è²èª¿
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                let y = pinyin || '';
                y = y.replace(/ /g, '');
                return [count, hanzi, y, hanziLength].join('\t');
            });

            const linesEb = linesEdu.filter(line => {
                // æ•™æ‹¼äºŒå­—ä»¥ä¸Šå…è²èª¿
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                return hanziLength && hanziLength >= 2;
            }).map(line => {
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                let y = pinyin || '';
                y = y.replace(/([aeiouyrmngptkbd])([zvsx])/g, '$1');
                y = y.replace(/ /g, '');
                return [count, hanzi, y, hanziLength].join('\t');
            });

            let linesEc = linesEdu.filter(line => {
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                return hanziLength && hanziLength >= 2;
            }).map(line => {
                const [count, hanzi, pinyin, hanziLength] = line.split('\t');
                let y = pinyin || '';
                y = y.split(' ').map(x => {
                    if (x.startsWith('tsh')) {
                        return x.slice(0, 3);
                    } else if (x.startsWith('rh') || x.startsWith('zh') || x.startsWith('ch') || x.startsWith('sh') || x.startsWith('ng') || x.startsWith('ts') || x.startsWith('ph') || x.startsWith('th') || x.startsWith('kh') || x.startsWith('bb')) {
                        return x.slice(0, 2);
                    } else {
                        return x.charAt(0);
                    }
                }).join('');
                return [count, hanzi, y, hanziLength].join('\t');
            });



/*
			let linesEd = linesEc.reduce((acc, line) => {
				const [count, hanzi, pinyin, hanziLength] = line.split('\t');
				if (hanziLength == 2) {
					if (!acc[pinyin]) {
						acc[pinyin] = [];
					}
					acc[pinyin].push({ count: parseInt(count), hanzi, line });
				}
				return acc;
			}, {});

			linesEd = Object.values(linesEd).flatMap(group => 
				group.sort((a, b) => b.count - a.count).slice(0, 5).map(item => item.line)
				//2å­—ç°¡ç¢¼å–å‰5å€‹;
			);
*/


			linesEc = linesEc.reduce((acc, line) => {
				const [count, hanzi, pinyin, hanziLength] = line.split('\t');
				if (hanziLength == 2) {
					if (!acc[pinyin]) {
						acc[pinyin] = [];
					}
					acc[pinyin].push({ count: parseInt(count), hanzi, line });
				} else if (hanziLength > 2) {
					// ä¿ç•™æ‰€æœ‰ hanziLength > 2 çš„è¡Œ
					if (!acc['>2']) {
						acc['>2'] = [];
					}
					acc['>2'].push({ count: parseInt(count), hanzi, line });
				}
				return acc;
			}, {});

			const linesEc2 = Object.values(linesEc)
				.flatMap(group => 
					group
					.filter(item => item.hanzi.length == 2)
					.sort((a, b) => b.count - a.count)
					.slice(0, 5)
					.map(item => item.line)
				);

			const linesEcMoreThan2 = (linesEc['>2'] || []).map(item => item.line);

			linesEc = [...linesEc2, ...linesEcMoreThan2];

//=================================

            // åˆä½µè³‡æ–™ä¸¦å»é‡
            let allLines = Array.from(new Set([...linesSa, ...linesSb, ...linesSc, ...linesEa, ...linesEb, ...linesEc]));




            // allLinesæ’åºï¼šhanziALength ç”±å°åˆ°å¤§ï¼Œå…¶æ¬¡countç”±å¤§åˆ°å°ï¼Œç¬¬ä¸‰å†æ’æ‹¼éŸ³

            allLines.sort((a, b) => {
                let [countA, hanziA, pinyinA, hanziALength] = a.split('\t');
                let [countB, hanziB, pinyinB, hanziBLength] = b.split('\t');
                countA = parseInt(countA)
                countB = parseInt(countB)
                hanziALength = parseInt(hanziALength);
                hanziBLength = parseInt(hanziBLength);

                if (hanziALength !== hanziBLength) {
                    return hanziALength - hanziBLength;
                }
                if (countA !== countB) {
                    return countB - countA;
                }
                return pinyinA.localeCompare(pinyinB);
            });





			let endLines = allLines.map(line => {
				const [count, hanzi, pinyin, hanziLength] = line.split('\t');
				return [pinyin, hanzi].join(' ');
				});
		
			resultLines = endLines;	
			
			if(endLines.length > 5){
				// åªé¡¯ç¤ºæœ€å¾Œ100è¡Œ
				const displayLines = endLines.slice(0, 100);
				document.getElementById('id_B').value = "åƒ…é¡¯ç¤ºå‰100è¡Œï¼Œä½†å¯è¤‡è£½å…¨éƒ¨ (å…± " + endLines.length + " è¡Œ)ï¼š\n" + displayLines.join('\n');				
			}else{
				document.getElementById('id_B').value = endLines.join('\n');			
			}
}



function generateText() {
    const text = document.getElementById('id_A').value.trim();
	let outputText = "";

    const chineseNumbers = "ä¸€,äºŒ,å…©,ä¸‰,å››,äº”,å…­,ä¸ƒ,å…«,ä¹,å,åä¸€,åäºŒ,åä¸‰,åå››,åäº”,åå…­,åä¸ƒ,åå…«,åä¹,äºŒå,ä¸‰å,å››å,äº”å,å…­å,ä¸ƒå,å…«å,ä¹å,ä¸€ç™¾,å…©ç™¾,äºŒç™¾,ä¸‰ç™¾,å››ç™¾,äº”ç™¾,å…­ç™¾,ä¸ƒç™¾,å…«ç™¾,ä¹ç™¾,ä¸€åƒ,å…©åƒ,äºŒåƒ,ä¸‰åƒ,å››åƒ,äº”åƒ,å…­åƒ,ä¸ƒåƒ,å…«åƒ,ä¹åƒ,ä¸€è¬,å…©è¬,äºŒè¬,ä¸‰è¬,å››è¬,äº”è¬,å…­è¬,ä¸ƒè¬,å…«è¬,ä¹è¬,åè¬,äºŒåè¬,ä¸‰åè¬,å››åè¬,äº”åè¬,å…­åè¬,ä¸ƒåè¬,å…«åè¬,ä¹åè¬,ä¸€ç™¾è¬,å…©ç™¾è¬,äºŒç™¾è¬,ä¸‰ç™¾è¬,å››ç™¾è¬,äº”ç™¾è¬,å…­ç™¾è¬,ä¸ƒç™¾è¬,å…«ç™¾è¬,ä¹ç™¾è¬,ä¸€åƒè¬,å…©åƒè¬,äºŒåƒè¬,ä¸‰åƒè¬,å››åƒè¬,äº”åƒè¬,å…­åƒè¬,ä¸ƒåƒè¬,å…«åƒè¬,ä¹åƒè¬".split(",");

    const KasuPeople = "ä½ ,ğ Š,ä½¢,ğ«£†,ä½ äºº,ğ Šäºº,ä½¢äºº,ğ«£†äºº,å¤§å®¶,é€å„•,å“ªå„•,å“ªå€‹,å“ªä½,å“ªè£¡,é˜¿æ€™,é˜¿ä¾,é˜¿å”,é˜¿å¬¸,é˜¿ä¼¯,é˜¿ãœ·,é˜¿çˆ¸,é˜¿å…¬,é˜¿åª½,å¤–å…¬,å¤–åª½".split(",");
    // ç¢ºå®šè¦æ›¿æ›çš„å­—
    let replaceList = [];
    if (text.includes('ä¸€')) {
        replaceList = chineseNumbers;
    } else if (text.includes('ä½ ')) {
        replaceList = KasuPeople;
    }

    // ç”Ÿæˆè©èª
    for (let i = 0; i < replaceList.length; i++) {
        let newText = text;
        if (replaceList === chineseNumbers) {
            newText = newText.replace('ä¸€', replaceList[i]);
        } else if (replaceList === KasuPeople) {
            newText = newText.replace('ä½ ', replaceList[i]);
        }
        outputText += `${newText}\n`;
    }

    document.getElementById('id_B').value = outputText;
}

function pojToTailuo(text) {
    let t = document.getElementById('id_A').value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		t = allText;
	}
	t = pojToTailuoFn(t);
	document.getElementById('id_B').value = t;
}


function pojToTailuoFn(text) {
    const replacements = [
        [/oe/g, 'ue'],
        [/oÌ‹e/g, 'uÌ‹e'],
        [/Ã³e/g, 'uÃ©'],
        [/Ã²e/g, 'uÃ¨'],
        [/Ã´e/g, 'uÃª'],
        [/Ç’e/g, 'uÄ›'],
        [/Åe/g, 'uÄ“'],
        [/oÌe/g, 'uÌe'],
        [/oa/g, 'ua'],
        [/Å‘a/g, 'uÌ‹a'],
        [/Ã³a/g, 'uÃ¡'],
        [/Ã²a/g, 'uÃ '],
        [/Ã´a/g, 'uÃ¢'],
        [/Ç’a/g, 'uÇ'],
        [/Åa/g, 'uÄ'],
        [/oÌa/g, 'uÌa'],
        [/oÃ¡/g, 'uÃ¡'],
        [/oÃ /g, 'uÃ '],
        [/oÃ¢/g, 'uÃ¢'],
        [/oÇ/g, 'uÇ'],
        [/oÄ/g, 'uÄ'],
        [/oÌa/g, 'uÌa'],
        [/oaÌ‹/g, 'uaÌ‹'],
        [/ek\b/g, 'ik'],
        [/eÌ‹k\b/g, 'iÌ‹k'],
        [/Ã©k\b/g, 'Ã­k'],
        [/Ã¨k\b/g, 'Ã¬k'],
        [/Ãªk\b/g, 'Ã®k'],
        [/Ä›k\b/g, 'Çk'],
        [/Ä“k\b/g, 'Ä«k'],
        [/eÌk\b/g, 'iÌk'],
        [/eng\b/g, 'ing'],
        [/eÌ‹ng\b/g, 'iÌ‹ng'],
        [/Ã©ng\b/g, 'Ã­ng'],
        [/Ã¨ng\b/g, 'Ã¬ng'],
        [/Ãªng\b/g, 'Ã®ng'],
        [/Ä›ng\b/g, 'Çng'],
        [/Ä“ng\b/g, 'Ä«ng'],
        [/eÌng\b/g, 'iÌng'],
        [/Oe/g, 'Ue'],
        [/OÌ‹e/g, 'UÌ‹e'],
        [/Ã“e/g, 'UÃ©'],
        [/Ã’e/g, 'UÃ¨'],
        [/Ã”e/g, 'UÃª'],
        [/Ç‘e/g, 'UÄ›'],
        [/ÅŒe/g, 'UÄ“'],
        [/OÌe/g, 'UÌe'],
        [/Oa/g, 'Ua'],
        [/Åa/g, 'UÌ‹a'],
        [/Ã“a/g, 'UÃ¡'],
        [/Ã’a/g, 'UÃ '],
        [/Ã”a/g, 'UÃ¢'],
        [/Ç‘a/g, 'UÇ'],
        [/ÅŒa/g, 'UÄ'],
        [/OÌa/g, 'UÌa'],
        [/OÃ¡/g, 'UÃ¡'],
        [/OÃ /g, 'UÃ '],
        [/OÃ¢/g, 'UÃ¢'],
        [/OÇ/g, 'UÇ'],
        [/OÄ/g, 'UÄ'],
        [/OÌa/g, 'UÌa'],
        [/OaÌ‹/g, 'UaÌ‹'],
        [/Ek\b/g, 'IÌk'],
        [/EÌ‹k\b/g, 'IÌ‹k'],
        [/Ã‰k\b/g, 'Ãk'],
        [/Ãˆk\b/g, 'ÃŒk'],
        [/ÃŠk\b/g, 'Ãk'],
        [/Äšk\b/g, 'Çk'],
        [/Ä’k\b/g, 'Äªk'],
        [/EÌk\b/g, 'IÌk'],
        [/Eng\b/g, 'IÌng'],
        [/EÌ‹ng\b/g, 'IÌ‹ng'],
        [/Ã‰ng\b/g, 'Ãng'],
        [/Ãˆng\b/g, 'ÃŒng'],
        [/ÃŠng\b/g, 'Ãng'],
        [/Äšng\b/g, 'Çng'],
        [/Ä’ng\b/g, 'Äªng'],
        [/EÌng\b/g, 'IÌng'],
        [/OÌ‹\u0358/g, 'OÌ‹o'],
        [/Ã“\u0358/g, 'Ã“o'],
        [/Ã’\u0358/g, 'Ã’o'],
        [/Ã”\u0358/g, 'Ã”o'],
        [/Ç‘\u0358/g, 'Ç‘o'],
        [/ÅŒ\u0358/g, 'ÅŒo'],
        [/OÌ\u0358/g, 'OÌo'],
        [/OÌ‹\u00B7/g, 'OÌ‹o'],
        [/Ã“\u00B7/g, 'Ã“o'],
        [/Ã’\u00B7/g, 'Ã’o'],
        [/Ã”\u00B7/g, 'Ã”o'],
        [/Ç‘\u00B7/g, 'Ç‘o'],
        [/ÅŒ\u00B7/g, 'ÅŒo'],
        [/OÌ\u00B7/g, 'OÌo'],
        [/o\u0358/g, 'oo'],
        [/Å‘\u0358/g, 'Å‘o'],
        [/Ã³\u0358/g, 'Ã³o'],
        [/Ã²\u0358/g, 'Ã²o'],
        [/Ã´\u0358/g, 'Ã´o'],
        [/Ç’\u0358/g, 'Ç’o'],
        [/Å\u0358/g, 'Åo'],
        [/oÌ\u0358/g, 'oÌo'],
        [/o\u00B7/g, 'oo'],
        [/Å‘\u00B7/g, 'Å‘o'],
        [/Ã³\u00B7/g, 'Ã³o'],
        [/Ã²\u00B7/g, 'Ã²o'],
        [/Ã´\u00B7/g, 'Ã´o'],
        [/Ç’\u00B7/g, 'Ç’o'],
        [/Å\u00B7/g, 'Åo'],
        [/oÌ\u00B7/g, 'oÌo'],
		[/â¿/g, 'nn'],
        [/\bCh([aeiounÅ‘Ã³Ã²Ã´Ç’ÅoÌaÌ‹Ã¡Ã Ã¢ÇÄaÌeÌ‹Ã©Ã¨ÃªÄ›Ä“eÌÅ±ÃºÃ¹Ã»Ç”Å«uÌiÌ‹Ã­Ã¬Ã®ÇÄ«iÌnÌ‹Å„Ç¹nÌ‚ÅˆnÌ„nÌ])([aeioumngptkhbd]{0,5})(?!\w)/g, 'Ts$1$2'],
        [/\bChh([aeiounÅ‘Ã³Ã²Ã´Ç’ÅoÌaÌ‹Ã¡Ã Ã¢ÇÄaÌeÌ‹Ã©Ã¨ÃªÄ›Ä“eÌÅ±ÃºÃ¹Ã»Ç”Å«uÌiÌ‹Ã­Ã¬Ã®ÇÄ«iÌnÌ‹Å„Ç¹nÌ‚ÅˆnÌ„nÌ])([aeioumngptkhbd]{0,5})(?!\w)/g, 'Tsh$1$2'],
        [/\bch([aeiounÅ‘Ã³Ã²Ã´Ç’ÅoÌaÌ‹Ã¡Ã Ã¢ÇÄaÌeÌ‹Ã©Ã¨ÃªÄ›Ä“eÌÅ±ÃºÃ¹Ã»Ç”Å«uÌiÌ‹Ã­Ã¬Ã®ÇÄ«iÌnÌ‹Å„Ç¹nÌ‚ÅˆnÌ„nÌ])([aeioumngptkhbd]{0,5})(?!\w)/g, 'ts$1$2'],
        [/\bchh([aeiounÅ‘Ã³Ã²Ã´Ç’ÅoÌaÌ‹Ã¡Ã Ã¢ÇÄaÌeÌ‹Ã©Ã¨ÃªÄ›Ä“eÌÅ±ÃºÃ¹Ã»Ç”Å«uÌiÌ‹Ã­Ã¬Ã®ÇÄ«iÌnÌ‹Å„Ç¹nÌ‚ÅˆnÌ„nÌ])([aeioumngptkhbd]{0,5})(?!\w)/g, 'tsh$1$2'],     
    ];
    for (const [pattern, replacement] of replacements) {
        text = text.replace(pattern, replacement);
    }
    return text;
}




function wordWrongToRight() {
    // ç•°é«”å­—è½‰æ­£å­—
    let t = document.getElementById('id_A').value;
	if (t.startsWith("è¼‰å…¥çš„è³‡æ–™å…±")) {
		t = allText;
	}
    // å»ºç«‹å°æ‡‰æ˜ å°„
let kasuOral = `
ï¹—	ï¼
ï¹™	ï¼ˆ
ï¹š	ï¼‰
ï¹	ï¼Œ
ï¹‘	ã€
ï¹’	ã€‚
ï¸°	ï¼š
ï¹•	ï¼š
ï¹”	ï¼›
ï¹–	ï¼Ÿ
ï¦º	äº†
ï¦Š	åŠ›
ï¨Œ	å…€
ï¦	å¥³
ï¥§	ä¸
ï¥	ä¸¹
ï§½	ä»€
ï§‘	å…­
ï¨€	åˆ‡
ï¦¨	ä»¤
ï¥£	åŒ—
ï¤†	å¥
ï§·	ç«‹
ï¦œ	åˆ—
ï¦	åŠ£
ï§	å
ï¨„	å®…
ï¦	å¹´
ï¨	ç¾½
ï¤´	è€
ï¥“	è‚‹
ï¨ˆ	è¡Œ
ï¤…	ä¸²
ï¤®	å†·
ï§	åˆ©
ï¤œ	åµ
ï§­	å
ï¦€	å‘‚
ï¦½	å°¿
ï¥ƒ	å¼„
ï¤	æ›´
ï§¡	æ
ï¥²	æ²ˆ
ï¥†	ç‰¢
ï¥¼	è‰¯
ï¨Š	è¦‹
ï¤‚	è»Š
ï¥±	è¾°
ï§©	é‡Œ
ï§†	é˜®
ï¦µ	ä¾‹
ï¤­	ä¾†
ï¥¸	å…©
ï§¿	åˆº
ï¤Œ	å¥ˆ
ï¦£	å¿µ
ï¤¥	æ‹‰
ï¨‚	æ‹“
ï§ 	æ˜“
ï§´	æ—
ï¥¨	æ³Œ
ï§£	æ³¥
ï§»	ç‚™
ï§º	ç‹€
ï¤Š	é‡‘
ï¦©	å›¹
ï¥›	å­¥
ï¦¬	æ€œ
ï§ˆ	æ»
ï¥·	äº®
ï¥¥	ä¾¿
ï¦	å’½
ï¤‰	å¥‘
ï¨	åº¦
ï§˜	å¾‹
ï¥ 	æ€’
ï¥³	æ‹¾
ï§‰	æŸ³
ï§Š	æµ
ï¨…	æ´
ï¤•	æ´›
ï¦­	ç²
ï¥­	çœ
ï¥´	è‹¥
ï¤¬	éƒ
ï¥‘	é™‹
ï¨‰	é™
ï§”	å€«
ï¦¾	æ–™
ï¦ƒ	æ—…
ï¤©	æœ—
ï§š	æ —
ï¤ª	æµª
ï¤–	çƒ™
ï¦Ÿ	çƒˆ
ï¤«	ç‹¼
ï§Œ	ç‰
ï¤—	ç
ï§	ç•™
ï¨—	ç›Š
ï¨™	ç¥
ï¥ª	ç´¢
ï§	ç´
ï§¾	èŒ¶
ï¤€	è±ˆ
ï¥’	å‹’
ï§«	åŒ¿
ï¥«	åƒ
ï¨‘	å´
ï§•	å´™
ï¥µ	æ 
ï¦¤	æ»
ï¥º	æ¢
ï§¢	æ¢¨
ï¥°	æ®º
ï¥¹	æ¶¼
ï§µ	æ·‹
ï¥	æ·š
ï§–	æ·ª
ï¥¡	ç‡
ï§¤	ç†
ï¥¶	ç•¥
ï¥¢	ç•°
ï§	ç¡«
ï¨š	ç¥¥
ï§¸	ç¬ 
ï§¹	ç²’
ï¥	ç´¯
ï¦¯	ç¾š
ï¦°	è†
ï¦š	é€£
ï¨¦	éƒ½
ï¥™	é™µ
ï§“	é™¸
ï¥€	é¹¿
ï¤¯	å‹
ï¤‹	å–‡
ï¤¡	åµ
ï¤¨	å»Š
ï¥¦	å¾©
ï¦¹	æƒ¡
ï¨’	æ™´
ï§¥	ç—¢
ï¥˜	è±
ï¦ 	è£‚
ï¨¥	é€¸
ï¥¾	é‡
ï§œ	éš†
ï¨ª	é£¯
ï¤¾	è‰
ï¤›	äº‚
ï¥¬	å¡
ï¨	å¡š
ï¦¢	å»‰
ï§™	æ…„
ï§…	æšˆ
ï§¬	æºº
ï¤„	æ»‘
ï§‹	æºœ
ï¦“	ç…‰
ï¤»	ç¢Œ
ï¤¼	ç¥¿
ï¥–	ç¨œ
ï¤˜	è½
ï¥®	è‘‰
ï¤¶	è™œ
ï§¨	è£¡
ï¤ƒ	è³ˆ
ï¥ˆ	è³‚
ï¤·	è·¯
ï¤™	é…ª
ï¦±	éˆ´
ï¥‰	é›·
ï¦²	é›¶
ï¨œ	é–
ï¨«	é£¼
ï¨	ï¨
ï§§	è£
ï¦»	åƒš
ï¥Ÿ	å¯§
ï¥‹	å±¢
ï¨‹	å»“
ï¥	æ¼
ï¦’	æ¼£
ï¨›	ç¦
ï¨	ç²¾
ï¥—	ç¶¾
ï¤½	ç¶ 
ï¤’	è£¸
ï¥¯	èªª
ï¦´	é ˜
ï¥”	å‡œ
ï§‡	åŠ‰
ï¦¼	å¯®
ï§Ÿ	å±¥
ï¦	æ†
ï§’	æˆ®
ï¦‘	æ’š
ï¥©	æ•¸
ï¨†	æš´
ï¥Œ	æ¨“
ï¤”	æ¨‚
ï¦®	ç‘©
ï¥‡	ç£Š
ï¦–	ç·´
ï¦™	è“®
ï¥½	è«’
ï¨¢	è«¸
ï¥	è«–
ï¦˜	è¼¦
ï§—	è¼ª
ï¨¨	é‹…
ï¦†	é–­
ï¤¹	é­¯
ï¦‰	é»
ï¦”	ç’‰
ï§‚	è“¼
ï¤°	æ“„
ï¦‹	æ›†
ï¦Œ	æ­·
ï§®	ç‡
ï§€	ç‡
ï§¯	ç’˜
ï¤³	ç›§
ï¨ƒ	ç³–
ï§¦	ç½¹
ï¥	è«¾
ï¤	è³´
ï¨‡	è¼»
ï§ƒ	é¼
ï¤¿	éŒ„
ï¨¬	é¤¨
ï¤š	é§±
ï§„	é¾
ï¤‡	é¾œ
ï¨•	å‡
ï¥¿	å‹µ
ï¦«	å¶º
ï¦¥	æ®®
ï¤¢	æ¿«
ï§	ç™‚
ï¥	ç¸·
ï¦—	è¯
ï§¶	è‡¨
ï¤‘	èº
ï¦›	éŠ
ï¦¸	éš¸
ï¥¤	ç£»
ï¥Š	å£˜
ï¦„	æ¿¾
ï¦§	çµ
ï¦¶	ç¦®
ï¥»	ç³§
ï¤£	è—
ï§ª	é›¢
ï¥‚	å£Ÿ
ï¦‚	å»¬
ï¤	æ‡¶
ï¤±	æ«“
ï¦¦	ç°¾
ï¤	ç¾…
ï¤¦	è‡˜
ï§¼	è­˜
ï§	é¡
ï¦ˆ	éº—
ï¤²	çˆ
ï¦…	ç¤ª
ï§°	è—º
ï¤µ	è˜†
ï¤¤	è¥¤
ï¦·	é†´
ï¤	æ¬„
ï¤	çˆ›
ï¤Ÿ	è˜­
ï¤§	è Ÿ
ï¤¸	éœ²
ï¨­	é¶´
ï¥„	ç± 
ï¥…	è¾
ï¥š	è®€
ï¦	è½¢
ï¦	æˆ€
ï¤	è˜¿
ï¤“	é‚
ï§²	é±—
ï§³	éºŸ
ï¦³	éˆ
ï¤º	é·º
ï¦‡	é©ª
ï¤ 	é¸
ï¨–	çŒª
ï¨˜	ç¤¼
ï¦•	ç§Š
ï§±	éš£
èƒ	æœ
æ¿•	æº¼
î	î
îœ	ğªœ¶
îœ…	ğ¬¦°
îš	ğ«
îœ	ğ«›
ï—©	ğ«
ï—ª	ğ«º
ï—®	ğ«»
ï—§	ó¿—§
ï—¯	ğ«Ÿ‚
ï—¨	ğ«™
î	ğ«ŸŠ
î‚ 	î
î¢	ğ«
î¤	ğ«›
î§	ğ«
î¨	ğ«º
î©	ğ«»
îª	ó¿—§
î«	ğ«Ÿ‚
î½	ğ«™
î‹	ğ«ŸŠ
æ•	æ•™
é“	éš
æ¸©	æº«
æˆ†	æˆ‡
éƒ	éƒ
éš	éš¨
è„š	è…³
å–	å”§
îœ›	ğª¹š
îœ‘	ğ«˜
î®	ğ«¾
î	ğ«­
îœ˜	ğ«»
îœƒ	ğ«¼
îœ¬	ğ«Ÿ§
îœœ	ğ« ›
îœ€	ğ«£†
îœ‡	ğ¬‘
î€	ğ¬–
î	ó¸¾¯
î¯	ï¿½
ï¼ï¼	â”€â”€
î	ğ°¹¬
îœ¥	ğ¬ –
îª	ğ°£»
î¯	ğ±±¿
ó¿—§	ğ°£»
ó¿•…	ğ±±¿
ó¸¾¯	ğ°¹¬
å²€	å‡º
æ²¡	æ²’
ç§ƒ	ç¦¿
åŠµ	åˆ¸
åˆ´	å‰
æŠ	æ‹—
æ®	æ­¿
ç•	ç•€
çˆ²	ç‚º
å¨±	å¨›
æŒŸ	æŒ¾
çœ	çœŸ
æ¬µ	æ¬¸
æµ„	æ·¨
è¡†	çœ¾
æ­³	æ­²
è¼°	æš¢
ğ§—Š	ç›¡
éº½	éº¼
å¥¬	ç
ç¸†	ç·ª
é§¡	ç½µ
è…Ÿ	è†£
ğ¤– 	ç‰†
ğ¦‰›	ç½…
éš·	éš¸
é²«	é¯½
æ«‰	æ«¥
èµ¢	è´
è®‰	è­´
é¼¹	é¼´
ğ¤’¿	ã¸
å»°	å»³
é‘š	é‘½
æˆ…	æˆ‡
æœ	èƒ
â¼€	ä¸€
â¼	ä¸¨
â¼‚	ä¸¶
â¼ƒ	ä¸¿
â¼„	ä¹™
â¼…	äº…
â¼†	äºŒ
â¼‡	äº 
â¼ˆ	äºº
â¼‰	å„¿
â¼Š	å…¥
â¼‹	å…«
â¼Œ	å†‚
â¼	å†–
â¼	å†«
â¼	å‡ 
â¼	å‡µ
â¼‘	åˆ€ 
â¼’	åŠ›
â¼“	å‹¹
â¼”	åŒ•
â¼•	åŒš
â¼–	åŒ¸
â¼—	å
â¼˜	åœ
â¼™	å©
â¼š	å‚
â¼›	å¶
â¼œ	åˆ
â¼	å£
â¼	å›—
â¼Ÿ	åœŸ
â¼ 	å£«
â¼¡	å¤‚
â¼¢	å¤Š
â¼£	å¤•
â¼¤	å¤§
â¼¥	å¥³
â¼¦	å­
â¼§	å®€
â¼¨	å¯¸
â¼©	å°
â¼ª	ğ¡¯
â¼«	å°¸
â¼¬	å±®
â¼­	å±±
â¼®	å·›
â¼¯	å·¥
â¼°	å·±
â¼±	å·¾
â¼²	å¹²
â¼³	å¹º
â¼´	å¹¿
â¼µ	å»´
â¼¶	å»¾
â¼·	å¼‹
â¼¸	å¼“
â¼¹	å½
â¼º	å½¡
â¼»	å½³
â¼¼	å¿ƒ
â¼½	æˆˆ
â¼¾	æˆ¶
â¼¿	æ‰‹
â½€	æ”¯
â½	æ”´ 
â½‚	æ–‡
â½ƒ	æ–—
â½„	æ–¤
â½…	æ–¹
â½†	æ— 
â½‡	æ—¥
â½ˆ	æ›°
â½‰	æœˆ
â½Š	æœ¨
â½‹	æ¬ 
â½Œ	æ­¢
â½	æ­¹ 
â½	æ®³
â½	æ¯‹
â½	æ¯”
â½‘	æ¯›
â½’	æ°
â½“	æ°”
â½”	æ°´
â½•	ç«
â½–	çˆª
â½—	çˆ¶
â½˜	çˆ»
â½™	çˆ¿
â½š	ç‰‡
â½›	ç‰™
â½œ	ç‰›
â½	çŠ¬
â½	ç„
â½Ÿ	ç‰
â½ 	ç“œ
â½¡	ç“¦
â½¢	ç”˜
â½£	ç”Ÿ
â½¤	ç”¨
â½¥	ç”°
â½¦	ç–‹
â½§	ç–’
â½¨	ç™¶
â½©	ç™½
â½ª	çš®
â½«	çš¿
â½¬	ç›®
â½­	çŸ›
â½®	çŸ¢
â½¯	çŸ³
â½°	ç¤º
â½±	ç¦¸
â½²	ç¦¾
â½³	ç©´
â½´	ç«‹
â½µ	ç«¹
â½¶	ç±³
â½·	ç³¸
â½¸	ç¼¶
â½¹	ç½‘
â½º	ç¾Š
â½»	ç¾½
â½¼	è€
â½½	è€Œ
â½¾	è€’
â½¿	è€³
â¾€	è¿
â¾	è‚‰
â¾‚	è‡£
â¾ƒ	è‡³
â¾„	è‡³
â¾…	è‡¼
â¾†	èˆŒ
â¾‡	èˆ›
â¾ˆ	èˆŸ
â¾‰	è‰®
â¾Š	è‰²
â¾‹	è‰¸
â¾Œ	è™
â¾	è™«
â¾	è¡€
â¾	è¡Œ
â¾	è¡£
â¾‘	è¥¾
â¾’	è¦‹
â¾“	è§’
â¾”	è¨€
â¾•	è°·
â¾–	è±†
â¾—	è±•
â¾˜	è±¸
â¾™	è²
â¾š	èµ¤
â¾›	èµ°
â¾œ	è¶³
â¾	èº«
â¾	è»Š
â¾Ÿ	è¾›
â¾ 	è¾°
â¾¡	è¾µ
â¾¢	é‚‘
â¾£	é…‰
â¾¤	é‡†
â¾¥	é‡Œ
â¾¦	é‡‘
â¾§	é•·
â¾¨	é–€
â¾©	é˜œ
â¾ª	éš¶
â¾«	éš¹
â¾¬	é›¨
â¾­	é’
â¾®	é
â¾¯	é¢
â¾°	é©
â¾±	éŸ‹
â¾²	éŸ­
â¾³	éŸ³
â¾´	é 
â¾µ	é¢¨
â¾¶	é£›
â¾·	é£Ÿ
â¾¸	é¦–
â¾¹	é¦™
â¾º	é¦¬
â¾»	éª¨
â¾¼	é«˜
â¾½	é«Ÿ
â¾¾	é¬¥
â¾¿	é¬¯
â¿€	é¬²
â¿	é¬¼
â¿‚	é­š
â¿ƒ	é³¥
â¿„	é¹µ
â¿…	é¹¿
â¿†	éº¥
â¿‡	éº»
â¿ˆ	é»ƒ
â¿‰	é»
â¿Š	é»‘
â¿‹	é»¹
â¿Œ	é»½
â¿	é¼
â¿	é¼“
â¿	é¼ 
â¿	é¼»
â¿‘	é½Š
â¿’	é½’
â¿“	é¾
â¿”	é¾œ
â¿•	é¾ 
â»‘	é•·
â»˜	é’
â»	é£Ÿ
â»£	éª¨
â»¤	é¬¼
â»©	é»ƒ
â»±	é¾œ
âº©	âº©
âºµ	âºµ
âº´	âº´
âº±	ç½“
âº«	ç½’
âº¼	âº¼
âº¿	âº¿
â»	â»
â»	â»
â»–	â»–
âº…	äº»
âº	å°¢
âº	å…€
âº	å°£
âº‘	ğ¡¯‚
âº–	å¿„
âº˜	æ‰Œ
âº¡	æ°µ
âº¢	æ°º
âº¨	çŠ­
âº£	ç¬
âº¤	çˆ«
âº‰	åˆ‚
âº™	æ”µ
âº	æ­º
`;
    
    let mappings = kasuOral.trim().split('\n').map(line => {
        let parts = line.split('\t');
        return [parts[0].trim(), parts[1].trim()];
    });

    for (let [original, replacement] of mappings) {
        let regex = new RegExp(original, 'g');
        t = t.replace(regex, replacement);
    }

    // å°‡çµæœå¯«å…¥åˆ°è¼¸å‡ºæ¡†
    document.getElementById('id_B').value = t;
}


let allData = [];
let allText = '';
function importData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.txt';

    input.onchange = async (event) => {
        const file = event.target.files[0];
        if (file) {
            const text = await file.text();	
            allData = text.split('\n').filter(line => line.trim() !== '');			
            const displayLines = allData.slice(0, 100);
            document.getElementById('id_A').value = "è¼‰å…¥çš„è³‡æ–™å…±" + allData.length + "è¡Œ (åƒ…é¡¯ç¤ºå‰ 100 è¡Œ)ï¼š\n" + displayLines.join('\n');
        }
    };

    input.click();
}





// æ¨¡æ“¬çš„é¸é …é…ç½®
const myOption = `
a1=ç¸½å­—æ•¸=countTextStatistics=èªªæ˜1
a2=å¥å­—æ•¸=countSentenceLengths=èªªæ˜2
a3=è¡Œå­—æ•¸=countLineLengths=èªªæ˜3
`;

// è§£æé¸é …é…ç½®ç‚ºå°è±¡
const optionsConfig = myOption.trim().split('\n').reduce((acc, line) => {
    const [code, name, func, desc] = line.split('=');
    acc[code] = {
        name: name.trim(),
        func: func.trim(),
        desc: desc.trim()
    };
    return acc;
}, {});



// åœ¨ç¶²é åŠ è¼‰æ™‚åŸ·è¡Œçš„å‡½æ•¸
function addOptionsIfParameterExists() {
    // ç²å– URL åƒæ•¸
    const urlParams = new URLSearchParams(window.location.search);
    const fnParam = urlParams.get('fn');

    // æª¢æŸ¥æ˜¯å¦æœ‰æŒ‡å®šçš„åƒæ•¸
    if (fnParam) {
        // å‰µå»º select å…ƒç´ 
        const select = document.createElement('select');
        select.setAttribute('onchange', 'handleDropdownChange(this)');
        select.setAttribute('onfocus', 'showOptions(this)');
        select.setAttribute('onblur', 'resetOptions(this)');

        // æ·»åŠ ç¬¬ä¸€å€‹ç¦ç”¨é¸é …
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.disabled = true;
        defaultOption.selected = true;
        defaultOption.innerText = 'è‡ªè¨‚';
        select.appendChild(defaultOption);

        // è§£æ fn åƒæ•¸ä¸¦ç”Ÿæˆå°æ‡‰çš„é¸é …
        const fnCodes = fnParam.split(',');
        fnCodes.forEach(code => {
            if (optionsConfig[code]) {
                const option = document.createElement('option');
                option.value = optionsConfig[code].func;
                option.title = optionsConfig[code].desc;
                option.innerText = optionsConfig[code].name;
                select.appendChild(option);
            }
        });

		// ç²å–ç›®æ¨™å®¹å™¨ä¸¦æ·»åŠ  select
		const buttonContainer = document.querySelector('.button-container');
		if (buttonContainer) {
			buttonContainer.insertBefore(select, buttonContainer.firstChild);
		}
    }
}

document.addEventListener("DOMContentLoaded", function() {
  // å–å¾— button-container å’Œ dropdown-container
  const buttonSelects = document.querySelectorAll('.button-container select');
  const dropdownContainer = document.querySelector('.dropdown-container');
  
  // æ¸…ç©ºåŸæœ‰çš„ dropdown-container
  dropdownContainer.innerHTML = '';

  // éæ­· button-container ä¸­çš„æ¯å€‹ select
  buttonSelects.forEach(buttonSelect => {
    // ç‚ºæ¯å€‹ select ç”Ÿæˆå°æ‡‰çš„ dropdown
    const dropdownDiv = document.createElement('div');
    dropdownDiv.classList.add('dropdown');
    
    const dropdownSelect = document.createElement('select');
    dropdownSelect.setAttribute('onchange', 'handleDropdownChange(this)');
    dropdownSelect.setAttribute('onfocus', 'showOptions(this)');
    dropdownSelect.setAttribute('onblur', 'resetOptions(this)');

    // å°‡ button select çš„æ‰€æœ‰é¸é …è¤‡è£½åˆ°æ–°çš„ dropdown select
    buttonSelect.querySelectorAll('option').forEach(option => {
      const newOption = document.createElement('option');
      newOption.value = option.value;
      newOption.textContent = option.textContent;
      newOption.title = option.title || ''; // ä¿ç•™ title å±¬æ€§
      dropdownSelect.appendChild(newOption);
    });

    // å°‡æ–°çš„ dropdown select åŠ å…¥åˆ° dropdownDivï¼Œç„¶å¾ŒåŠ å…¥åˆ° dropdown-container
    dropdownDiv.appendChild(dropdownSelect);
    dropdownContainer.appendChild(dropdownDiv);
  });
});


// ç•¶ç¶²é åŠ è¼‰å®Œç•¢å¾ŒåŸ·è¡Œä¸Šè¿°å‡½æ•¸
window.onload = addOptionsIfParameterExists;

// <script src="script.js"></script>

</script>


</body>
</html>

